<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Training: Complete Course</title>
    
    <!-- Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0fdf4; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .ar { font-family: 'Segoe UI', Tahoma, sans-serif; direction: rtl; }
    </style>
</head>
<body class="bg-green-50 text-gray-800">

    <!-- HEADER / UNIT SELECTOR -->
    <div class="bg-green-800 text-white p-4 shadow-md">
        <div class="max-w-4xl mx-auto flex flex-col gap-4">
            <div class="flex justify-between items-center">
                <h1 class="text-xl font-bold flex items-center gap-2">ðŸ‡¬ðŸ‡§ English Trainer</h1>
                <button onclick="app.testAudio()" class="bg-green-700 hover:bg-green-600 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2 border border-green-500">
                    ðŸ”Š Audio Test
                </button>
            </div>
            
            <!-- Unit Selector (Scrollbar) -->
            <div id="unit-selector" class="flex overflow-x-auto gap-2 bg-green-900/50 p-2 rounded-lg hide-scroll">
                <!-- Units werden hier rein generiert -->
            </div>
        </div>
    </div>

    <!-- NAVIGATION TABS -->
    <div class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b border-green-100 p-2 mb-6 shadow-sm">
        <div id="nav-tabs" class="max-w-4xl mx-auto flex justify-center gap-2 overflow-x-auto hide-scroll">
            <button onclick="app.setTab('vocab')" class="nav-btn px-4 py-2 rounded-lg font-bold text-sm transition-all bg-green-600 text-white shadow-md" data-tab="vocab">1. Words</button>
            <button onclick="app.setTab('sentences')" class="nav-btn px-4 py-2 rounded-lg font-bold text-sm transition-all text-gray-500 hover:bg-green-50" data-tab="sentences">2. Sentences</button>
            <button onclick="app.setTab('opinion')" class="nav-btn px-4 py-2 rounded-lg font-bold text-sm transition-all text-gray-500 hover:bg-green-50" data-tab="opinion">3. Opinion</button>
            <button onclick="app.setTab('report')" class="nav-btn px-4 py-2 rounded-lg font-bold text-sm transition-all text-gray-500 hover:bg-green-50" data-tab="report">4. Report</button>
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <div id="app-content" class="container mx-auto max-w-3xl p-4 min-h-[60vh]"></div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==========================================
        // DATEN: HIER SIND ALLE 6 MODULE
        // ==========================================
        const COURSE_DATA = [
            // MODUL 1: HOLIDAYS
            {
                id: "unit1",
                title: "1: Holidays",
                icon: "ðŸŒ´",
                vocab: [
                    { en: "played football", de: "FuÃŸball gespielt", ar: "Ù„Ø¹Ø¨ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…", icon: "âš½" },
                    { en: "watched TV", de: "ferngesehen", ar: "Ø´Ø§Ù‡Ø¯ Ø§Ù„ØªÙ„ÙØ§Ø²", icon: "ðŸ“º" },
                    { en: "slept long", de: "lange geschlafen", ar: "Ù†Ø§Ù… Ø·ÙˆÙŠÙ„Ø§Ù‹", icon: "ðŸ˜´" },
                    { en: "met friends", de: "Freunde getroffen", ar: "Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", icon: "ðŸ¤" },
                    { en: "played video games", de: "Videospiele gespielt", ar: "Ù„Ø¹Ø¨ Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ", icon: "ðŸŽ®" },
                    { en: "ate pizza", de: "Pizza gegessen", ar: "Ø£ÙƒÙ„ Ø§Ù„Ø¨ÙŠØªØ²Ø§", icon: "ðŸ•" },
                    { en: "went to the park", de: "in den Park gegangen", ar: "Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©", icon: "ðŸŒ³" },
                    { en: "listened to music", de: "Musik gehÃ¶rt", ar: "Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰", icon: "ðŸŽ§" }
                ],
                sentenceParts: {
                    col1: { title: "When?", items: ["In the holidays"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["played football", "watched TV", "met friends", "slept long", "ate pizza", "went to the park"] }
                },
                opinions: [
                    { en: "cool", de: "cool / toll", ar: "Ø±Ø§Ø¦Ø¹", type: "pos" },
                    { en: "fun", de: "spaÃŸig", ar: "Ù…Ù…ØªØ¹", type: "pos" },
                    { en: "ok", de: "okay", ar: "Ø­Ø³Ù†Ø§Ù‹", type: "neu" },
                    { en: "boring", de: "langweilig", ar: "Ù…Ù…Ù„", type: "neg" }
                ]
            },
            
            // MODUL 2: HOBBIES
            {
                id: "unit2",
                title: "2: Hobbies",
                icon: "ðŸŽ®",
                vocab: [
                    { en: "read comics", de: "Comics lesen", ar: "Ù‚Ø±Ø£ Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…ØµÙˆØ±Ø©", icon: "ðŸ“š" },
                    { en: "ride a bike", de: "Fahrrad fahren", ar: "Ø±ÙƒØ¨ Ø¯Ø±Ø§Ø¬Ø©", icon: "ðŸš²" },
                    { en: "swim", de: "schwimmen", ar: "Ø³Ø¨Ø­", icon: "ðŸŠ" },
                    { en: "draw pictures", de: "Bilder malen", ar: "Ø±Ø³Ù… ØµÙˆØ±Ø§Ù‹", icon: "ðŸŽ¨" },
                    { en: "play cards", de: "Karten spielen", ar: "Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ±Ù‚", icon: "ðŸƒ" },
                    { en: "dance", de: "tanzen", ar: "Ø±Ù‚Øµ", icon: "ðŸ’ƒ" }
                ],
                sentenceParts: {
                    col1: { title: "How often?", items: ["Every day", "Sometimes", "Never"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["read comics", "ride my bike", "swim", "draw pictures", "play cards"] }
                },
                opinions: [
                    { en: "great", de: "groÃŸartig", ar: "Ø¹Ø¸ÙŠÙ…", type: "pos" },
                    { en: "fun", de: "spaÃŸig", ar: "Ù…Ù…ØªØ¹", type: "pos" },
                    { en: "okay", de: "okay", ar: "Ø­Ø³Ù†Ø§Ù‹", type: "neu" },
                    { en: "stupid", de: "blÃ¶d", ar: "ØºØ¨ÙŠ", type: "neg" }
                ]
            },

            // MODUL 3: SCHOOL (Neu)
            {
                id: "unit3",
                title: "3: School",
                icon: "ðŸ«",
                vocab: [
                    { en: "Math", de: "Mathe", ar: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", icon: "ðŸ“" },
                    { en: "English", de: "Englisch", ar: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", icon: "ðŸ‡¬ðŸ‡§" },
                    { en: "History", de: "Geschichte", ar: "ØªØ§Ø±ÙŠØ®", icon: "ðŸ›ï¸" },
                    { en: "Art", de: "Kunst", ar: "ÙÙ†", icon: "ðŸŽ¨" },
                    { en: "Ruler", de: "Lineal", ar: "Ù…Ø³Ø·Ø±Ø©", icon: "ðŸ“" },
                    { en: "Pen", de: "Stift", ar: "Ù‚Ù„Ù…", icon: "ðŸ–Šï¸" },
                    { en: "Bag", de: "Tasche", ar: "Ø­Ù‚ÙŠØ¨Ø©", icon: "ðŸŽ’" },
                    { en: "Book", de: "Buch", ar: "ÙƒØªØ§Ø¨", icon: "ðŸ“–" }
                ],
                sentenceParts: {
                    col1: { title: "When?", items: ["On Monday", "On Tuesday", "On Friday"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["have Math", "have English", "have History", "have Art"] }
                },
                opinions: [
                    { en: "easy", de: "einfach", ar: "Ø³Ù‡Ù„", type: "pos" },
                    { en: "hard", de: "schwer", ar: "ØµØ¹Ø¨", type: "neg" },
                    { en: "good", de: "gut", ar: "Ø¬ÙŠØ¯", type: "pos" },
                    { en: "bad", de: "schlecht", ar: "Ø³ÙŠØ¡", type: "neg" }
                ]
            },

            // MODUL 4: TOWN (Neu)
            {
                id: "unit4",
                title: "4: Town",
                icon: "ðŸ™ï¸",
                vocab: [
                    { en: "Cinema", de: "Kino", ar: "Ø³ÙŠÙ†Ù…Ø§", icon: "ðŸ¿" },
                    { en: "Supermarket", de: "Supermarkt", ar: "Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª", icon: "ðŸ›’" },
                    { en: "Park", de: "Park", ar: "Ø­Ø¯ÙŠÙ‚Ø©", icon: "ðŸŒ³" },
                    { en: "Hospital", de: "Krankenhaus", ar: "Ù…Ø³ØªØ´ÙÙ‰", icon: "ðŸ¥" },
                    { en: "Go left", de: "Geh links", ar: "Ø§Ø°Ù‡Ø¨ Ù„Ù„ÙŠØ³Ø§Ø±", icon: "â¬…ï¸" },
                    { en: "Go right", de: "Geh rechts", ar: "Ø§Ø°Ù‡Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ†", icon: "âž¡ï¸" },
                    { en: "Go straight", de: "Geh geradeaus", ar: "Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø£Ù…Ø§Ù…", icon: "â¬†ï¸" },
                    { en: "Stop", de: "Stopp", ar: "Ù‚Ù", icon: "ðŸ›‘" }
                ],
                sentenceParts: {
                    col1: { title: "Where?", items: ["To the cinema", "To the park", "To the shop"] },
                    col2: { title: "Please...", items: ["go left", "go right", "go straight"] },
                    col3: { title: "Distance", items: ["and stop", "for 100 meters"] }
                },
                opinions: [
                    { en: "near", de: "nah", ar: "Ù‚Ø±ÙŠØ¨", type: "pos" },
                    { en: "far", de: "weit", ar: "Ø¨Ø¹ÙŠØ¯", type: "neu" },
                    { en: "big", de: "groÃŸ", ar: "ÙƒØ¨ÙŠØ±", type: "pos" },
                    { en: "small", de: "klein", ar: "ØµØºÙŠØ±", type: "neu" }
                ]
            },

            // MODUL 5: SHOPPING (Neu)
            {
                id: "unit5",
                title: "5: Shopping",
                icon: "ðŸ›ï¸",
                vocab: [
                    { en: "T-shirt", de: "T-Shirt", ar: "Ù‚Ù…ÙŠØµ", icon: "ðŸ‘•" },
                    { en: "Jeans", de: "Jeans", ar: "Ø¬ÙŠÙ†Ø²", icon: "ðŸ‘–" },
                    { en: "Shoes", de: "Schuhe", ar: "Ø£Ø­Ø°ÙŠØ©", icon: "ðŸ‘Ÿ" },
                    { en: "Apple", de: "Apfel", ar: "ØªÙØ§Ø­Ø©", icon: "ðŸŽ" },
                    { en: "Banana", de: "Banane", ar: "Ù…ÙˆØ²Ø©", icon: "ðŸŒ" },
                    { en: "Bread", de: "Brot", ar: "Ø®Ø¨Ø²", icon: "ðŸž" },
                    { en: "Buy", de: "Kaufen", ar: "ÙŠØ´ØªØ±ÙŠ", icon: "ðŸ’³" },
                    { en: "Money", de: "Geld", ar: "Ù…Ø§Ù„", icon: "ðŸ’¶" }
                ],
                sentenceParts: {
                    col1: { title: "Polite", items: ["I would like", "I want"] },
                    col2: { title: "Action", items: ["to buy"] },
                    col3: { title: "Item", items: ["a T-shirt", "jeans", "an apple", "bread"] }
                },
                opinions: [
                    { en: "cheap", de: "billig", ar: "Ø±Ø®ÙŠØµ", type: "pos" },
                    { en: "expensive", de: "teuer", ar: "ØºØ§Ù„ÙŠ", type: "neg" },
                    { en: "nice", de: "schÃ¶n", ar: "Ø¬Ù…ÙŠÙ„", type: "pos" },
                    { en: "ugly", de: "hÃ¤sslich", ar: "Ù‚Ø¨ÙŠØ­", type: "neg" }
                ]
            },

            // MODUL 6: TRAVEL (Neu)
            {
                id: "unit6",
                title: "6: Travel",
                icon: "âœˆï¸",
                vocab: [
                    { en: "Train", de: "Zug", ar: "Ù‚Ø·Ø§Ø±", icon: "ðŸš†" },
                    { en: "Bus", de: "Bus", ar: "Ø­Ø§ÙÙ„Ø©", icon: "ðŸšŒ" },
                    { en: "Plane", de: "Flugzeug", ar: "Ø·Ø§Ø¦Ø±Ø©", icon: "âœˆï¸" },
                    { en: "Car", de: "Auto", ar: "Ø³ÙŠØ§Ø±Ø©", icon: "ðŸš—" },
                    { en: "Ticket", de: "Ticket", ar: "ØªØ°ÙƒØ±Ø©", icon: "ðŸŽ«" },
                    { en: "Passport", de: "Pass", ar: "Ø¬ÙˆØ§Ø² Ø³ÙØ±", icon: "ðŸ›‚" },
                    { en: "Suitcase", de: "Koffer", ar: "Ø­Ù‚ÙŠØ¨Ø© Ø³ÙØ±", icon: "ðŸ§³" },
                    { en: "Hotel", de: "Hotel", ar: "ÙÙ†Ø¯Ù‚", icon: "ðŸ¨" }
                ],
                sentenceParts: {
                    col1: { title: "When?", items: ["In summer", "Next week"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "Travel by...", items: ["go by plane", "go by train", "go by car"] }
                },
                opinions: [
                    { en: "fast", de: "schnell", ar: "Ø³Ø±ÙŠØ¹", type: "pos" },
                    { en: "slow", de: "langsam", ar: "Ø¨Ø·ÙŠØ¡", type: "neg" },
                    { en: "exciting", de: "aufregend", ar: "Ù…Ø«ÙŠØ±", type: "pos" },
                    { en: "boring", de: "langweilig", ar: "Ù…Ù…Ù„", type: "neg" }
                ]
            }
        ];

        // ==========================================
        // UI TEXTS (DEUTSCH & ARABISCH)
        // ==========================================
        const UI_TEXT = {
            vocab: { de: "Klicke auf die Karte. HÃ¶re das Wort. Schreibe das Wort.", ar: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©. Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ÙƒÙ„Ù…Ø©. Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©." },
            sentences: { de: "WÃ¤hle aus jeder Spalte ein Wort. Baue einen Satz.", ar: "Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ù† ÙƒÙ„ Ù‚Ø§Ø¦Ù…Ø©. Ø±ÙƒØ¨ Ø¬Ù…Ù„Ø©." },
            opinion: { de: "Wie findest du das? WÃ¤hle eine Meinung.", ar: "Ù…Ø§ Ø±Ø£ÙŠÙƒØŸ Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø©." },
            report: { de: "Schreibe deinen Namen. Drucke das Blatt.", ar: "Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ. Ø§Ø·Ø¨Ø¹ Ø§Ù„ÙˆØ±Ù‚Ø©." }
        };

        // ==========================================
        // APP LOGIC
        // ==========================================
        
        const app = {
            currentUnitId: COURSE_DATA[0].id,
            activeTab: 'vocab',
            state: { sentenceSelection: { col1: null, col2: null, col3: null }, flippedCards: {}, quizInputs: {} },
            data: { sentences: [], opinions: {} },

            init: function() {
                this.loadData();
                this.renderUnitSelector();
                this.render();
                
                // Audio Init Versuch
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.getVoices(); 
                }
            },

            // --- AUDIO CORE ---
            speak: function(text) {
                if (!('speechSynthesis' in window)) {
                    alert("Dein Browser unterstÃ¼tzt leider keine Audio-Ausgabe.");
                    return;
                }

                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9; 
                utterance.volume = 1.0; 
                window.speechSynthesis.speak(utterance);
            },

            testAudio: function() {
                this.speak("Hello! The audio is working.");
            },

            getUnit: function() { return COURSE_DATA.find(u => u.id === this.currentUnitId) || COURSE_DATA[0]; },

            setUnit: function(id) {
                this.currentUnitId = id;
                this.activeTab = 'vocab';
                this.state = { sentenceSelection: {}, flippedCards: {}, quizInputs: {} };
                this.loadData();
                this.renderUnitSelector();
                this.render();
            },

            setTab: function(tabId) {
                this.activeTab = tabId;
                this.updateNavStyles();
                this.render();
            },

            loadData: function() {
                try {
                    const saved = localStorage.getItem('english_data_' + this.currentUnitId);
                    if (saved) { this.data = JSON.parse(saved); } else { this.data = { sentences: [], opinions: {} }; }
                } catch(e) {}
            },

            saveData: function() {
                try { localStorage.setItem('english_data_' + this.currentUnitId, JSON.stringify(this.data)); } catch(e) {}
            },

            addSentence: function(sentence) {
                if (!this.data.sentences.includes(sentence)) {
                    this.data.sentences.push(sentence);
                    this.saveData();
                }
            },

            addOpinion: function(activity, opinion) {
                this.data.opinions[activity] = opinion;
                this.saveData();
            },

            // --- RENDERING HELPERS ---
            renderInstructions: function(type) {
                return `
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r-lg">
                        <p class="font-bold text-gray-700 text-sm mb-1">ðŸ‡©ðŸ‡ª ${UI_TEXT[type].de}</p>
                        <p class="ar text-gray-500 text-sm text-right">ðŸ‡¸ðŸ‡¦ ${UI_TEXT[type].ar}</p>
                    </div>
                `;
            },

            renderUnitSelector: function() {
                const container = document.getElementById('unit-selector');
                container.innerHTML = COURSE_DATA.map(unit => `
                    <button onclick="app.setUnit('${unit.id}')" 
                        class="px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap transition-colors flex items-center gap-2 border-2 ${this.currentUnitId === unit.id ? 'bg-white text-green-800 border-white shadow-lg' : 'bg-green-700 text-green-100 border-green-600 hover:bg-green-600'}">
                        <span>${unit.icon}</span> <span>${unit.title}</span>
                    </button>
                `).join('');
            },

            updateNavStyles: function() {
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const isActive = btn.getAttribute('data-tab') === this.activeTab;
                    btn.className = `nav-btn px-4 py-2 rounded-lg font-bold text-sm transition-all ${isActive ? 'bg-green-600 text-white shadow-md scale-105' : 'text-gray-500 hover:bg-green-50'}`;
                });
            },

            render: function() {
                const content = document.getElementById('app-content');
                const unit = this.getUnit();

                if (this.activeTab === 'vocab') this.renderVocab(content, unit);
                else if (this.activeTab === 'sentences') this.renderSentences(content, unit);
                else if (this.activeTab === 'opinion') this.renderOpinion(content, unit);
                else if (this.activeTab === 'report') this.renderReport(content, unit);
            },

            // 1. VOCAB RENDERER
            renderVocab: function(container, unit) {
                const quizHTML = unit.vocab.slice(0, 3).map((word, idx) => {
                    const masked = word.en.replace(/[aeiouAEIOU]/g, '_');
                    const inputVal = this.state.quizInputs[word.en] || '';
                    const isCorrect = inputVal.toLowerCase().trim() === word.en.toLowerCase();
                    
                    return `
                        <div class="flex flex-col sm:flex-row gap-2 items-center bg-gray-50 p-2 rounded-lg mb-2">
                            <span class="font-mono text-lg bg-white border px-3 py-1 rounded w-full sm:w-48 text-center tracking-widest text-gray-600 font-bold">${masked}</span>
                            <div class="relative w-full flex-grow">
                                <input type="text" oninput="app.handleQuizInput('${word.en}', this.value)" value="${inputVal}"
                                    class="w-full border-2 p-2 pl-4 rounded-lg outline-none ${inputVal.length > 2 ? (isCorrect ? 'border-green-500 bg-green-50 text-green-800' : 'border-red-300 bg-red-50') : 'border-gray-200'}" placeholder="Word...">
                                ${isCorrect ? '<i class="ph ph-check-circle text-green-500 text-2xl absolute right-2 top-1/2 -translate-y-1/2"></i>' : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="animate-fade-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2"><span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">Step 1</span> Learn the Words</h2>
                        ${this.renderInstructions('vocab')}
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10">
                            ${unit.vocab.map((word, idx) => `
                                <div onclick="app.toggleCard(${idx})" class="bg-white rounded-xl shadow-sm hover:shadow-md p-6 cursor-pointer border-2 transition-all relative overflow-hidden group ${this.state.flippedCards[idx] ? 'border-green-500 bg-green-50' : 'border-gray-100'}">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-4xl">${word.icon}</span>
                                        <button onclick="event.stopPropagation(); app.speak('${word.en.replace(/'/g, "\\'")}')" class="w-10 h-10 flex items-center justify-center bg-blue-50 rounded-full hover:bg-blue-500 hover:text-white text-blue-500 transition-colors"><i class="ph ph-speaker-high text-xl"></i></button>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mt-2">${word.en}</h3>
                                    ${this.state.flippedCards[idx] ? `
                                        <div class="mt-2 pt-2 border-t border-green-200">
                                            <p class="text-green-700 font-bold">= ${word.de}</p>
                                            <p class="text-gray-500 ar text-right">= ${word.ar}</p>
                                        </div>
                                    ` : '<p class="text-xs text-gray-400 mt-2">Click to translate</p>'}
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                             <h3 class="text-xl font-bold text-gray-800 mb-4">âš¡ Speed Quiz</h3>
                             ${quizHTML}
                        </div>
                    </div>
                `;
            },

            toggleCard: function(idx) {
                this.state.flippedCards[idx] = !this.state.flippedCards[idx];
                this.render(); 
            },

            handleQuizInput: function(id, val) {
                this.state.quizInputs[id] = val;
                this.render(); 
                setTimeout(() => {
                    const inputs = document.querySelectorAll(`input[value="${val}"]`);
                    if(inputs.length > 0) inputs[inputs.length-1].focus();
                }, 10);
            },


            // 2. SENTENCE RENDERER
            renderSentences: function(container, unit) {
                const sel = this.state.sentenceSelection;
                const isComplete = sel.col1 && sel.col2 && sel.col3;
                
                const renderCol = (id, data, color) => `
                    <div class="bg-${color}-50 p-4 rounded-xl border border-${color}-100">
                        <h3 class="font-bold text-${color}-800 mb-3 uppercase text-sm tracking-wide">${data.title}</h3>
                        ${data.items.map(item => `
                            <button onclick="app.selectSentencePart('${id}', '${item}')" 
                                class="w-full p-3 mb-2 rounded-lg text-left transition-all text-sm font-medium ${sel[id] === item ? `bg-${color}-600 text-white shadow-lg` : `bg-white text-gray-600 hover:bg-${color}-100`}">
                                ${item}
                            </button>
                        `).join('')}
                    </div>
                `;

                container.innerHTML = `
                    <div class="animate-fade-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2"><span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">Step 2</span> Build Sentences</h2>
                        ${this.renderInstructions('sentences')}
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            ${renderCol('col1', unit.sentenceParts.col1, 'blue')}
                            ${renderCol('col2', unit.sentenceParts.col2, 'purple')}
                            ${renderCol('col3', unit.sentenceParts.col3, 'orange')}
                        </div>
                        <div class="bg-gray-800 text-white p-8 rounded-2xl shadow-xl text-center">
                             <div class="text-xl md:text-3xl mb-6 font-mono font-medium">
                                <span class="${sel.col1 ? 'text-blue-300' : 'text-gray-600'}">${sel.col1 || '...'}</span>
                                <span class="${sel.col2 ? 'text-purple-300' : 'text-gray-600'}">${sel.col2 || '...'}</span>
                                <span class="${sel.col3 ? 'text-orange-300' : 'text-gray-600'}">${sel.col3 || '...'}</span>.
                             </div>
                             ${isComplete ? `<button onclick="app.saveCurrentSentence()" class="bg-green-500 hover:bg-green-400 text-white font-bold py-3 px-8 rounded-full shadow-lg animate-bounce">Save It</button>` : ''}
                        </div>
                        
                        <div class="mt-8">
                            <h3 class="font-bold text-gray-500 text-sm uppercase mb-3">Your Sentences</h3>
                            <div class="space-y-2">
                                ${this.data.sentences.map(s => `
                                    <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center">
                                        <span class="text-gray-700">${s}</span>
                                        <button onclick="app.speak('${s.replace(/'/g, "\\'")}')" class="text-blue-500"><i class="ph ph-speaker-high"></i></button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            },

            selectSentencePart: function(col, val) {
                this.state.sentenceSelection[col] = val;
                this.render();
            },

            saveCurrentSentence: function() {
                const s = this.state.sentenceSelection;
                const full = `${s.col1} ${s.col2} ${s.col3}.`;
                this.addSentence(full);
                this.state.sentenceSelection = { col1: null, col2: null, col3: null };
                this.speak("Excellent!");
                this.render();
            },


            // 3. OPINION RENDERER
            renderOpinion: function(container, unit) {
                const activities = unit.vocab.map(v => v.en).slice(0, 5);
                
                container.innerHTML = `
                    <div class="animate-fade-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2"><span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">Step 3</span> Express Opinions</h2>
                        ${this.renderInstructions('opinion')}
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            ${unit.opinions.map(op => `
                                <div onclick="app.speak('${op.en}')" class="p-4 rounded-xl text-center border-2 cursor-pointer hover:scale-105 transition-transform ${op.type === 'pos' ? 'bg-green-50 border-green-200' : op.type === 'neg' ? 'bg-red-50 border-red-200' : 'bg-yellow-50 border-yellow-200'}">
                                    <div class="text-xl font-bold text-gray-800">${op.en}</div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <div>${op.de}</div>
                                        <div class="ar">${op.ar}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                            ${activities.map(act => `
                                <div class="mb-4 pb-4 border-b border-gray-50 last:border-0 last:pb-0">
                                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                        <p class="font-medium text-gray-700 min-w-[150px]">${act} was...</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${unit.opinions.map(op => `
                                                <button onclick="app.saveOpinion('${act.replace(/'/g, "\\'")}', '${op.en}')" 
                                                    class="px-3 py-1 rounded-full text-sm font-medium border transition-all ${this.data.opinions[act] === op.en ? 'bg-gray-800 text-white border-gray-800' : 'bg-white text-gray-600 hover:bg-gray-50'}">
                                                    ${op.en}
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            saveOpinion: function(act, op) {
                this.addOpinion(act, op);
                this.speak(`${act} was ${op}`);
                this.render();
            },


            // 4. REPORT RENDERER
            renderReport: function(container, unit) {
                container.innerHTML = `
                    <div class="max-w-2xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2"><span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">Step 4</span> Final Report</h2>
                        ${this.renderInstructions('report')}
                        
                        <div class="bg-white p-8 rounded-xl shadow-2xl border-t-8 border-green-600 relative overflow-hidden">
                             <div class="flex justify-between items-start mb-8 border-b border-gray-100 pb-6">
                                <div><h1 class="text-3xl font-bold text-gray-900">My English Report</h1><p class="text-green-600 font-medium">${unit.title}</p></div>
                             </div>
                             <div class="mb-8 bg-gray-50 p-4 rounded-lg">
                                <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Student Name</label>
                                <input type="text" class="w-full text-2xl bg-transparent border-b-2 border-gray-300 focus:border-green-500 outline-none pb-1 text-gray-800 placeholder-gray-300" placeholder="Your Name...">
                             </div>
                             <div class="space-y-8 text-lg leading-relaxed relative z-10">
                                <div>
                                    <h4 class="font-bold text-gray-900 flex items-center gap-2 mb-2">My Sentences</h4>
                                    ${this.data.sentences.length > 0 ? `<ul class="bg-green-50/50 rounded-lg p-4 space-y-2 border border-green-100">${this.data.sentences.map(s => `<li>â€¢ ${s}</li>`).join('')}</ul>` : '<p class="text-red-400 text-sm italic">Go to Step 2 to build sentences.</p>'}
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900 flex items-center gap-2 mb-2">My Opinions</h4>
                                    ${Object.keys(this.data.opinions).length > 0 ? `<ul class="bg-yellow-50/50 rounded-lg p-4 space-y-2 border border-yellow-100">${Object.entries(this.data.opinions).map(([act, op]) => `<li>â€¢ ${act} was <strong>${op}</strong>.</li>`).join('')}</ul>` : '<p class="text-red-400 text-sm italic">Go to Step 3 to add opinions.</p>'}
                                </div>
                             </div>
                             <div class="mt-12 pt-6 border-t border-gray-100 flex justify-between items-center text-gray-400 text-xs uppercase tracking-wide"><span>Teacher Signature</span><span>${new Date().toLocaleDateString()}</span></div>
                        </div>
                        <button onclick="window.print()" class="w-full mt-6 bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-black transition-all flex items-center justify-center gap-2 group"><i class="ph ph-printer text-2xl"></i> Print Report</button>
                    </div>
                `;
            }
        };

        // Start the App
        app.init();

    </script>
</body>
</html>
