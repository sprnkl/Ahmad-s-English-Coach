<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahmed's English App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0fdf4; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .ar { font-family: 'Segoe UI', Tahoma, sans-serif; direction: rtl; }
        
        /* Karten Animationen */
        .perspective { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
    </style>
</head>
<body class="bg-green-50 text-gray-800 pb-20">

    <!-- HEADER -->
    <div class="bg-green-800 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex flex-col gap-4">
            <div class="flex justify-between items-center flex-wrap gap-2">
                <h1 class="text-xl font-bold flex items-center gap-2">ğŸ‡¬ğŸ‡§ Ahmed's English App</h1>
                <button onclick="app.testAudio()" class="bg-green-700 hover:bg-green-600 text-white px-3 py-1 rounded-full text-xs flex items-center gap-2 border border-green-500">
                    ğŸ”Š Audio Check / ÙØ­Øµ Ø§Ù„ØµÙˆØª
                </button>
            </div>
            
            <!-- Unit Selector -->
            <div id="unit-selector" class="flex overflow-x-auto gap-2 bg-green-900/50 p-2 rounded-lg hide-scroll">
                <!-- Wird per JS gefÃ¼llt -->
            </div>
        </div>
    </div>

    <!-- NAVIGATION TABS -->
    <div id="nav-container" class="bg-white/90 backdrop-blur border-b border-green-100 p-2 mb-6 shadow-sm">
        <div id="nav-tabs" class="max-w-4xl mx-auto flex justify-center gap-2 overflow-x-auto hide-scroll">
            <!-- Tabs werden hier generiert -->
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <div id="app-content" class="container mx-auto max-w-3xl p-4 min-h-[60vh]"></div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==========================================
        // 1. DATEN & TEXTE
        // ==========================================
        
        const UI = {
            tabs: {
                list: { en: "List", de: "Liste", ar: "Ù‚Ø§Ø¦Ù…Ø©" },
                vocab: { en: "Words", de: "WÃ¶rter", ar: "ÙƒÙ„Ù…Ø§Øª" },
                sentences: { en: "Sentences", de: "SÃ¤tze", ar: "Ø¬Ù…Ù„" },
                memory: { en: "Memory", de: "Memory", ar: "Ø°Ø§ÙƒØ±Ø©" },
                scramble: { en: "Scramble", de: "Buchstabensalat", ar: "Ø®Ù„Ø· Ø§Ù„Ø­Ø±ÙˆÙ" }
            },
            btn: {
                allWords: { en: "All Words & Games", de: "Alle WÃ¶rter & Spiele", ar: "ÙƒÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨" },
                newWords: { en: "New Words", de: "Neue WÃ¶rter", ar: "ÙƒÙ„Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" },
                checkSave: { en: "Check & Save", de: "PrÃ¼fen & Speichern", ar: "ØªØ­Ù‚Ù‚ ÙˆØ­ÙØ¸" },
                restart: { en: "Restart", de: "Neustart", ar: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„" },
                skip: { en: "Skip Word", de: "Wort Ã¼berspringen", ar: "ØªØ®Ø·Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø©" }
            },
            instr: {
                list: { en: "Listen to all words.", de: "HÃ¶re dir alle WÃ¶rter an.", ar: "Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª." },
                vocab: { en: "Listen and learn.", de: "HÃ¶re und lerne.", ar: "Ø§Ø³ØªÙ…Ø¹ ÙˆØªØ¹Ù„Ù…." },
                sentences: { en: "Build and write.", de: "Baue und schreibe.", ar: "Ø¨Ù†Ø§Ø¡ ÙˆÙƒØªØ§Ø¨Ø©." },
                memory: { en: "Find pairs.", de: "Finde Paare.", ar: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø²ÙˆØ§Ø¬." },
                scramble: { en: "Sort letters.", de: "Sortiere Buchstaben.", ar: "Ø±ØªØ¨ Ø§Ù„Ø­Ø±ÙˆÙ." }
            }
        };

        const COURSE_DATA = [
            // UNIT 1
            {
                id: "unit1",
                title: { en: "1: Free Time", de: "1: Freizeit", ar: "1: ÙˆÙ‚Øª Ø§Ù„ÙØ±Ø§Øº" }, 
                icon: "âš½",
                vocab: [
                    // Die bisherigen 8
                    { en: "play football", de: "FuÃŸball spielen", ar: "ÙŠÙ„Ø¹Ø¨ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…", icon: "âš½" },
                    { en: "watch TV", de: "fernsehen", ar: "ÙŠØ´Ø§Ù‡Ø¯ Ø§Ù„ØªÙ„ÙØ§Ø²", icon: "ğŸ“º" },
                    { en: "sleep", de: "schlafen", ar: "ÙŠÙ†Ø§Ù…", icon: "ğŸ˜´" },
                    { en: "meet friends", de: "Freunde treffen", ar: "ÙŠÙ‚Ø§Ø¨Ù„ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡", icon: "ğŸ¤" },
                    { en: "play games", de: "Spiele spielen", ar: "ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", icon: "ğŸ®" },
                    { en: "eat pizza", de: "Pizza essen", ar: "ÙŠØ£ÙƒÙ„ Ø§Ù„Ø¨ÙŠØªØ²Ø§", icon: "ğŸ•" },
                    { en: "go to the park", de: "in den Park gehen", ar: "ÙŠØ°Ù‡Ø¨ Ù„Ù„Ø­Ø¯ÙŠÙ‚Ø©", icon: "ğŸŒ³" },
                    { en: "listen to music", de: "Musik hÃ¶ren", ar: "ÙŠØ³ØªÙ…Ø¹ Ù„Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰", icon: "ğŸ§" },
                    
                    // Die 20 neuen WÃ¶rter (Simple Present)
                    { en: "read a book", de: "ein Buch lesen", ar: "ÙŠÙ‚Ø±Ø£ ÙƒØªØ§Ø¨Ø§Ù‹", icon: "ğŸ“–" },
                    { en: "go swimming", de: "schwimmen gehen", ar: "ÙŠØ°Ù‡Ø¨ Ù„Ù„Ø³Ø¨Ø§Ø­Ø©", icon: "ğŸŠ" },
                    { en: "play tennis", de: "Tennis spielen", ar: "ÙŠÙ„Ø¹Ø¨ Ø§Ù„ØªÙ†Ø³", icon: "ğŸ¾" },
                    { en: "ride a horse", de: "reiten", ar: "ÙŠØ±ÙƒØ¨ Ø­ØµØ§Ù†", icon: "ğŸ" },
                    { en: "cook dinner", de: "Abendessen kochen", ar: "ÙŠØ·Ø¨Ø® Ø§Ù„Ø¹Ø´Ø§Ø¡", icon: "ğŸ³" },
                    { en: "paint a picture", de: "ein Bild malen", ar: "ÙŠØ±Ø³Ù… ØµÙˆØ±Ø©", icon: "ğŸ¨" },
                    { en: "sing a song", de: "ein Lied singen", ar: "ÙŠØºÙ†ÙŠ Ø£ØºÙ†ÙŠØ©", icon: "ğŸ¤" },
                    { en: "dance", de: "tanzen", ar: "ÙŠØ±Ù‚Øµ", icon: "ğŸ’ƒ" },
                    { en: "travel", de: "reisen", ar: "ÙŠØ³Ø§ÙØ±", icon: "âœˆï¸" },
                    { en: "visit family", de: "Familie besuchen", ar: "ÙŠØ²ÙˆØ± Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦" },
                    { en: "go shopping", de: "einkaufen gehen", ar: "ÙŠØ°Ù‡Ø¨ Ù„Ù„ØªØ³ÙˆÙ‚", icon: "ğŸ›ï¸" },
                    { en: "eat ice cream", de: "Eis essen", ar: "ÙŠØ£ÙƒÙ„ Ø§Ù„Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…", icon: "ğŸ¦" },
                    { en: "drink tea", de: "Tee trinken", ar: "ÙŠØ´Ø±Ø¨ Ø§Ù„Ø´Ø§ÙŠ", icon: "â˜•" },
                    { en: "write an email", de: "E-Mail schreiben", ar: "ÙŠÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©", icon: "ğŸ“§" },
                    { en: "take a photo", de: "Foto machen", ar: "ÙŠÙ„ØªÙ‚Ø· ØµÙˆØ±Ø©", icon: "ğŸ“¸" },
                    { en: "walk the dog", de: "Hund ausfÃ¼hren", ar: "ÙŠÙ…Ø´ÙŠ Ø§Ù„ÙƒÙ„Ø¨", icon: "ğŸ•" },
                    { en: "play guitar", de: "Gitarre spielen", ar: "ÙŠØ¹Ø²Ù Ø§Ù„Ø¬ÙŠØªØ§Ø±", icon: "ğŸ¸" },
                    { en: "watch a movie", de: "Film schauen", ar: "ÙŠØ´Ø§Ù‡Ø¯ ÙÙŠÙ„Ù…Ø§Ù‹", icon: "ğŸ¬" },
                    { en: "go to the beach", de: "zum Strand gehen", ar: "ÙŠØ°Ù‡Ø¨ Ù„Ù„Ø´Ø§Ø·Ø¦", icon: "ğŸ–ï¸" },
                    { en: "ride a scooter", de: "Roller fahren", ar: "ÙŠØ±ÙƒØ¨ Ø³ÙƒÙˆØªØ±", icon: "ğŸ›´" }
                ],
                sentenceParts: {
                    col1: { title: "Person", items: ["I", "We", "They"] },
                    col2: { title: "Action (Simple Present)", items: ["play football", "watch TV", "eat pizza", "meet friends"] },
                    col3: { title: "Time/Place", items: ["at the weekend", "in the park", "at home", "every day"] }
                }
            }, // <--- Komma nicht vergessen!
            // UNIT 2
            {
                id: "unit2", title: { en: "2: Hobbies", de: "2: Hobbys", ar: "2: Ø§Ù„Ù‡ÙˆØ§ÙŠØ§Øª" }, icon: "ğŸ®",
                vocab: [
                    { en: "read comics", de: "Comics lesen", ar: "ÙŠÙ‚Ø±Ø£ Ù‚ØµØµ", icon: "ğŸ“š" },
                    { en: "ride a bike", de: "Rad fahren", ar: "ÙŠØ±ÙƒØ¨ Ø¯Ø±Ø§Ø¬Ø©", icon: "ğŸš²" },
                    { en: "swim", de: "schwimmen", ar: "ÙŠØ³Ø¨Ø­", icon: "ğŸŠ" },
                    { en: "draw", de: "malen", ar: "ÙŠØ±Ø³Ù…", icon: "ğŸ¨" },
                    { en: "play cards", de: "Karten spielen", ar: "ÙŠÙ„Ø¹Ø¨ ÙˆØ±Ù‚", icon: "ğŸƒ" },
                    { en: "dance", de: "tanzen", ar: "ÙŠØ±Ù‚Øµ", icon: "ğŸ’ƒ" }
                ],
                sentenceParts: {
                    col1: { title: "Time", items: ["Every day", "Sometimes"] },
                    col2: { title: "Person", items: ["I", "We"] },
                    col3: { title: "Action", items: ["read comics", "ride a bike", "swim", "dance"] }
                }
            },
            // UNIT 3
            {
                id: "unit3", title: { en: "3: School", de: "3: Schule", ar: "3: Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" }, icon: "ğŸ«",
                vocab: [
                    { en: "Math", de: "Mathe", ar: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª", icon: "ğŸ“" },
                    { en: "English", de: "Englisch", ar: "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", icon: "ğŸ‡¬ğŸ‡§" },
                    { en: "pen", de: "Stift", ar: "Ù‚Ù„Ù…", icon: "ğŸ–Šï¸" },
                    { en: "bag", de: "Tasche", ar: "Ø­Ù‚ÙŠØ¨Ø©", icon: "ğŸ’" },
                    { en: "book", de: "Buch", ar: "ÙƒØªØ§Ø¨", icon: "ğŸ“–" },
                    { en: "ruler", de: "Lineal", ar: "Ù…Ø³Ø·Ø±Ø©", icon: "ğŸ“" }
                ],
                sentenceParts: {
                    col1: { title: "Day", items: ["On Monday", "On Tuesday"] },
                    col2: { title: "Person", items: ["I", "We"] },
                    col3: { title: "Have", items: ["have Math", "have English", "have a test"] }
                }
            },
            // UNIT 4
            {
                id: "unit4", title: { en: "4: Town", de: "4: Stadt", ar: "4: Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" }, icon: "ğŸ™ï¸",
                vocab: [
                    { en: "cinema", de: "Kino", ar: "Ø³ÙŠÙ†Ù…Ø§", icon: "ğŸ¿" },
                    { en: "park", de: "Park", ar: "Ø­Ø¯ÙŠÙ‚Ø©", icon: "ğŸŒ³" },
                    { en: "supermarket", de: "Supermarkt", ar: "Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª", icon: "ğŸ›’" },
                    { en: "school", de: "Schule", ar: "Ù…Ø¯Ø±Ø³Ø©", icon: "ğŸ«" },
                    { en: "go left", de: "links gehen", ar: "ÙŠØ³Ø§Ø±", icon: "â¬…ï¸" },
                    { en: "go right", de: "rechts gehen", ar: "ÙŠÙ…ÙŠÙ†", icon: "â¡ï¸" },
                    { en: "stop", de: "stopp", ar: "Ù‚Ù", icon: "ğŸ›‘" }
                ],
                sentenceParts: {
                    col1: { title: "Imperative", items: ["Please go", "Go"] },
                    col2: { title: "Direction", items: ["left", "right", "straight"] },
                    col3: { title: "Place", items: ["to the cinema", "to the park", "to school"] }
                }
            },
            // UNIT 5
            {
                id: "unit5", title: { en: "5: Shopping", de: "5: Einkaufen", ar: "5: Ø§Ù„ØªØ³ÙˆÙ‚" }, icon: "ğŸ›ï¸",
                vocab: [
                    { en: "t-shirt", de: "T-Shirt", ar: "Ù‚Ù…ÙŠØµ", icon: "ğŸ‘•" },
                    { en: "jeans", de: "Jeans", ar: "Ø¬ÙŠÙ†Ø²", icon: "ğŸ‘–" },
                    { en: "apple", de: "Apfel", ar: "ØªÙØ§Ø­Ø©", icon: "ğŸ" },
                    { en: "banana", de: "Banane", ar: "Ù…ÙˆØ²Ø©", icon: "ğŸŒ" },
                    { en: "buy", de: "kaufen", ar: "ÙŠØ´ØªØ±ÙŠ", icon: "ğŸ’³" },
                    { en: "money", de: "Geld", ar: "Ù…Ø§Ù„", icon: "ğŸ’¶" }
                ],
                sentenceParts: {
                    col1: { title: "Person", items: ["I", "We"] },
                    col2: { title: "Verb", items: ["buy", "want", "need"] },
                    col3: { title: "Item", items: ["a t-shirt", "jeans", "an apple"] }
                }
            },
            // UNIT 6
            {
                id: "unit6", title: { en: "6: My Body", de: "6: KÃ¶rper", ar: "6: Ø¬Ø³Ù…ÙŠ" }, icon: "ğŸ’ª",
                vocab: [
                    { en: "head", de: "Kopf", ar: "Ø±Ø£Ø³", icon: "ğŸ˜¶" },
                    { en: "arm", de: "Arm", ar: "Ø°Ø±Ø§Ø¹", icon: "ğŸ’ª" },
                    { en: "leg", de: "Bein", ar: "Ø³Ø§Ù‚", icon: "ğŸ¦µ" },
                    { en: "hand", de: "Hand", ar: "ÙŠØ¯", icon: "âœ‹" },
                    { en: "foot", de: "FuÃŸ", ar: "Ù‚Ø¯Ù…", icon: "ğŸ¦¶" },
                    { en: "eye", de: "Auge", ar: "Ø¹ÙŠÙ†", icon: "ğŸ‘ï¸" }
                ],
                sentenceParts: {
                    col1: { title: "Command", items: ["Touch your", "Point to your"] },
                    col2: { title: "Side", items: ["left", "right"] },
                    col3: { title: "Part", items: ["hand", "foot", "eye", "ear"] }
                }
            },
            // UNIT 7
            {
                id: "unit7", title: { en: "7: Travel", de: "7: Reisen", ar: "7: Ø§Ù„Ø³ÙØ±" }, icon: "âœˆï¸",
                vocab: [
                    { en: "train", de: "Zug", ar: "Ù‚Ø·Ø§Ø±", icon: "ğŸš†" },
                    { en: "bus", de: "Bus", ar: "Ø­Ø§ÙÙ„Ø©", icon: "ğŸšŒ" },
                    { en: "plane", de: "Flugzeug", ar: "Ø·Ø§Ø¦Ø±Ø©", icon: "âœˆï¸" },
                    { en: "car", de: "Auto", ar: "Ø³ÙŠØ§Ø±Ø©", icon: "ğŸš—" },
                    { en: "ticket", de: "Ticket", ar: "ØªØ°ÙƒØ±Ø©", icon: "ğŸ«" },
                    { en: "hotel", de: "Hotel", ar: "ÙÙ†Ø¯Ù‚", icon: "ğŸ¨" }
                ],
                sentenceParts: {
                    col1: { title: "Time", items: ["In summer", "On Monday"] },
                    col2: { title: "Person", items: ["I", "We"] },
                    col3: { title: "Action", items: ["go by bus", "go by car", "go by plane"] }
                }
            },
            // UNIT 8
            {
                id: "unit8", title: { en: "8: Animals", de: "8: Tiere", ar: "8: Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª" }, icon: "ğŸ¾",
                vocab: [
                    { en: "dog", de: "Hund", ar: "ÙƒÙ„Ø¨", icon: "ğŸ•" },
                    { en: "cat", de: "Katze", ar: "Ù‚Ø·Ø©", icon: "ğŸˆ" },
                    { en: "lion", de: "LÃ¶we", ar: "Ø£Ø³Ø¯", icon: "ğŸ¦" },
                    { en: "elephant", de: "Elefant", ar: "ÙÙŠÙ„", icon: "ğŸ˜" },
                    { en: "bird", de: "Vogel", ar: "Ø·Ø§Ø¦Ø±", icon: "ğŸ¦" },
                    { en: "fish", de: "Fisch", ar: "Ø³Ù…ÙƒØ©", icon: "ğŸŸ" }
                ],
                sentenceParts: {
                    col1: { title: "Start", items: ["Look,", "I see"] },
                    col2: { title: "Size", items: ["a big", "a small", "a fast"] },
                    col3: { title: "Animal", items: ["lion", "elephant", "cat", "dog"] }
                }
            },
            // UNIT 9
            {
                id: "unit9", title: { en: "9: Food", de: "9: Essen", ar: "9: Ø§Ù„Ø·Ø¹Ø§Ù…" }, icon: "ğŸ”",
                vocab: [
                    { en: "burger", de: "Burger", ar: "Ø¨Ø±ØºØ±", icon: "ğŸ”" },
                    { en: "salad", de: "Salat", ar: "Ø³Ù„Ø·Ø©", icon: "ğŸ¥—" },
                    { en: "water", de: "Wasser", ar: "Ù…Ø§Ø¡", icon: "ğŸ’§" },
                    { en: "milk", de: "Milch", ar: "Ø­Ù„ÙŠØ¨", icon: "ğŸ¥›" },
                    { en: "juice", de: "Saft", ar: "Ø¹ØµÙŠØ±", icon: "ğŸ§ƒ" },
                    { en: "cake", de: "Kuchen", ar: "ÙƒØ¹ÙƒØ©", icon: "ğŸ°" }
                ],
                sentenceParts: {
                    col1: { title: "Polite", items: ["I like", "I want"] },
                    col2: { title: "Action", items: ["to eat", "to drink"] },
                    col3: { title: "Item", items: ["a burger", "salad", "water", "juice"] }
                }
            },
            // UNIT 10
            {
                id: "unit10", title: { en: "10: My Day", de: "10: Mein Tag", ar: "10: ÙŠÙˆÙ…ÙŠ" }, icon: "â°",
                vocab: [
                    { en: "morning", de: "Morgen", ar: "ØµØ¨Ø§Ø­", icon: "ğŸŒ…" },
                    { en: "bed", de: "Bett", ar: "Ø³Ø±ÙŠØ±", icon: "ğŸ›ï¸" },
                    { en: "breakfast", de: "FrÃ¼hstÃ¼ck", ar: "Ø¥ÙØ·Ø§Ø±", icon: "ğŸ¥£" },
                    { en: "school bus", de: "Schulbus", ar: "Ø­Ø§ÙÙ„Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", icon: "ğŸšŒ" },
                    { en: "homework", de: "Hausaufgaben", ar: "ÙˆØ§Ø¬Ø¨ Ù…Ù†Ø²Ù„ÙŠ", icon: "ğŸ“" },
                    { en: "shower", de: "Dusche", ar: "Ø§Ø³ØªØ­Ù…Ø§Ù…", icon: "ğŸš¿" }
                ],
                sentenceParts: {
                    col1: { title: "Time", items: ["In the morning", "At 8 o'clock"] },
                    col2: { title: "Person", items: ["I", "We"] },
                    col3: { title: "Action", items: ["get up", "eat breakfast", "go to school"] }
                }
            },
            // UNIT 11
            {
                id: "unit11", title: { en: "11: Family", de: "11: Familie", ar: "11: Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©" }, icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
                vocab: [
                    { en: "mother", de: "Mutter", ar: "Ø£Ù…", icon: "ğŸ‘©" },
                    { en: "father", de: "Vater", ar: "Ø£Ø¨", icon: "ğŸ‘¨" },
                    { en: "sister", de: "Schwester", ar: "Ø£Ø®Øª", icon: "ğŸ‘§" },
                    { en: "brother", de: "Bruder", ar: "Ø£Ø®", icon: "ğŸ‘¦" },
                    { en: "baby", de: "Baby", ar: "Ø·ÙÙ„", icon: "ğŸ‘¶" },
                    { en: "friend", de: "Freund", ar: "ØµØ¯ÙŠÙ‚", icon: "ğŸ§‘â€ğŸ¤â€ğŸ§‘" }
                ],
                sentenceParts: {
                    col1: { title: "Start", items: ["This is my", "I love my"] },
                    col2: { title: "Person", items: ["mother", "father", "sister", "brother"] },
                    col3: { title: "Name", items: ["Anna", "Tom", "Ali", "Sara"] }
                }
            },
            // UNIT 12
            {
                id: "unit12", title: { en: "12: Clothes", de: "12: Kleidung", ar: "12: Ø§Ù„Ù…Ù„Ø§Ø¨Ø³" }, icon: "ğŸ§¥",
                vocab: [
                    { en: "jacket", de: "Jacke", ar: "Ø¬Ø§ÙƒÙŠØª", icon: "ğŸ§¥" },
                    { en: "hat", de: "Hut", ar: "Ù‚Ø¨Ø¹Ø©", icon: "ğŸ§¢" },
                    { en: "shoes", de: "Schuhe", ar: "Ø£Ø­Ø°ÙŠØ©", icon: "ğŸ‘Ÿ" },
                    { en: "socks", de: "Socken", ar: "Ø¬ÙˆØ§Ø±Ø¨", icon: "ğŸ§¦" },
                    { en: "pullover", de: "Pulli", ar: "Ø¨Ù„ÙˆÙØ±", icon: "ğŸ§¥" }
                ],
                sentenceParts: {
                    col1: { title: "Person", items: ["I", "He", "She"] },
                    col2: { title: "Verb", items: ["wear", "wears"] },
                    col3: { title: "Item", items: ["a jacket", "a hat", "blue shoes"] }
                }
            },
            // UNIT 13
            {
                id: "unit13", title: { en: "13: Weather", de: "13: Wetter", ar: "13: Ø§Ù„Ø·Ù‚Ø³" }, icon: "â˜€ï¸",
                vocab: [
                    { en: "sun", de: "Sonne", ar: "Ø´Ù…Ø³", icon: "â˜€ï¸" },
                    { en: "rain", de: "Regen", ar: "Ù…Ø·Ø±", icon: "ğŸŒ§ï¸" },
                    { en: "wind", de: "Wind", ar: "Ø±ÙŠØ§Ø­", icon: "ğŸ’¨" },
                    { en: "hot", de: "heiÃŸ", ar: "Ø­Ø§Ø±", icon: "ğŸ¥µ" },
                    { en: "cold", de: "kalt", ar: "Ø¨Ø§Ø±Ø¯", icon: "ğŸ¥¶" }
                ],
                sentenceParts: {
                    col1: { title: "Time", items: ["Today", "Tomorrow"] },
                    col2: { title: "Verb", items: ["is", "will be"] },
                    col3: { title: "Weather", items: ["sunny", "rainy", "hot", "cold"] }
                }
            },
            // UNIT 14
            {
                id: "unit14", title: { en: "14: Numbers", de: "14: Zahlen", ar: "14: Ø§Ù„Ø£Ø±Ù‚Ø§Ù…" }, icon: "ğŸ”¢",
                vocab: [
                    { en: "one", de: "Eins", ar: "ÙˆØ§Ø­Ø¯", icon: "1ï¸âƒ£" },
                    { en: "two", de: "Zwei", ar: "Ø§Ø«Ù†Ø§Ù†", icon: "2ï¸âƒ£" },
                    { en: "three", de: "Drei", ar: "Ø«Ù„Ø§Ø«Ø©", icon: "3ï¸âƒ£" },
                    { en: "four", de: "Vier", ar: "Ø£Ø±Ø¨Ø¹Ø©", icon: "4ï¸âƒ£" },
                    { en: "five", de: "FÃ¼nf", ar: "Ø®Ù…Ø³Ø©", icon: "5ï¸âƒ£" }
                ],
                sentenceParts: {
                    col1: { title: "Subject", items: ["I have", "I see"] },
                    col2: { title: "Number", items: ["one", "two", "three", "five"] },
                    col3: { title: "Object", items: ["pens", "books", "apples", "cars"] }
                }
            },
            // UNIT 15
            {
                id: "unit15", title: { en: "15: My Room", de: "15: Mein Zimmer", ar: "15: ØºØ±ÙØªÙŠ" }, icon: "ğŸ›ï¸",
                vocab: [
                    { en: "bed", de: "Bett", ar: "Ø³Ø±ÙŠØ±", icon: "ğŸ›ï¸" },
                    { en: "chair", de: "Stuhl", ar: "ÙƒØ±Ø³ÙŠ", icon: "ğŸª‘" },
                    { en: "desk", de: "Tisch", ar: "Ø·Ø§ÙˆÙ„Ø©", icon: "ğŸ–¥ï¸" },
                    { en: "lamp", de: "Lampe", ar: "Ù…ØµØ¨Ø§Ø­", icon: "ğŸ’¡" },
                    { en: "door", de: "TÃ¼r", ar: "Ø¨Ø§Ø¨", icon: "ğŸšª" }
                ],
                sentenceParts: {
                    col1: { title: "Where?", items: ["In my room", "Next to me"] },
                    col2: { title: "Is", items: ["is"] },
                    col3: { title: "Object", items: ["a bed", "a chair", "a desk", "a lamp"] }
                }
            },
            // UNIT 16
            {
                id: "unit16", title: { en: "16: Feelings", de: "16: GefÃ¼hle", ar: "16: Ø§Ù„Ù…Ø´Ø§Ø¹Ø±" }, icon: "ğŸ˜Š",
                vocab: [
                    { en: "happy", de: "glÃ¼cklich", ar: "Ø³Ø¹ÙŠØ¯", icon: "ğŸ˜Š" },
                    { en: "sad", de: "traurig", ar: "Ø­Ø²ÙŠÙ†", icon: "ğŸ˜¢" },
                    { en: "tired", de: "mÃ¼de", ar: "Ù…ØªØ¹Ø¨", icon: "ğŸ˜´" },
                    { en: "hungry", de: "hungrig", ar: "Ø¬Ø§Ø¦Ø¹", icon: "ğŸ˜‹" },
                    { en: "sick", de: "krank", ar: "Ù…Ø±ÙŠØ¶", icon: "ğŸ¤’" }
                ],
                sentenceParts: {
                    col1: { title: "Person", items: ["I am", "He is", "She is"] },
                    col2: { title: "Very", items: ["very", "a little"] },
                    col3: { title: "Feeling", items: ["happy", "sad", "tired", "hungry"] }
                }
            },
            // UNIT 17
            {
                id: "unit17", title: { en: "17: Jobs", de: "17: Berufe", ar: "17: Ø§Ù„ÙˆØ¸Ø§Ø¦Ù" }, icon: "ğŸ‘®",
                vocab: [
                    { en: "teacher", de: "Lehrer", ar: "Ù…Ø¹Ù„Ù…", icon: "ğŸ‘¨â€ğŸ«" },
                    { en: "doctor", de: "Arzt", ar: "Ø·Ø¨ÙŠØ¨", icon: "ğŸ‘¨â€âš•ï¸" },
                    { en: "police", de: "Polizei", ar: "Ø´Ø±Ø·Ø©", icon: "ğŸ‘®" },
                    { en: "driver", de: "Fahrer", ar: "Ø³Ø§Ø¦Ù‚", icon: "ğŸš•" }
                ],
                sentenceParts: {
                    col1: { title: "Person", items: ["My father", "My mother"] },
                    col2: { title: "Verb", items: ["is a"] },
                    col3: { title: "Job", items: ["teacher", "doctor", "driver", "police officer"] }
                }
            },
            // UNIT 18
            {
                id: "unit18", title: { en: "18: Colors", de: "18: Farben", ar: "18: Ø§Ù„Ø£Ù„ÙˆØ§Ù†" }, icon: "ğŸ¨",
                vocab: [
                    { en: "red", de: "Rot", ar: "Ø£Ø­Ù…Ø±", icon: "ğŸ”´" },
                    { en: "blue", de: "Blau", ar: "Ø£Ø²Ø±Ù‚", icon: "ğŸ”µ" },
                    { en: "green", de: "GrÃ¼n", ar: "Ø£Ø®Ø¶Ø±", icon: "ğŸŸ¢" },
                    { en: "yellow", de: "Gelb", ar: "Ø£ØµÙØ±", icon: "ğŸŸ¡" },
                    { en: "black", de: "Schwarz", ar: "Ø£Ø³ÙˆØ¯", icon: "âš«" }
                ],
                sentenceParts: {
                    col1: { title: "Object", items: ["The car", "The ball", "My shirt"] },
                    col2: { title: "Is", items: ["is"] },
                    col3: { title: "Color", items: ["red", "blue", "green", "black"] }
                }
            },
            // UNIT 19
            {
                id: "unit19", title: { en: "19: At Home", de: "19: Zu Hause", ar: "19: ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„" }, icon: "ğŸ ",
                vocab: [
                    { en: "kitchen", de: "KÃ¼che", ar: "Ù…Ø·Ø¨Ø®", icon: "ğŸ³" },
                    { en: "bathroom", de: "Bad", ar: "Ø­Ù…Ø§Ù…", icon: "ğŸ›" },
                    { en: "garden", de: "Garten", ar: "Ø­Ø¯ÙŠÙ‚Ø©", icon: "ğŸŒ»" },
                    { en: "living room", de: "Wohnzimmer", ar: "ØºØ±ÙØ© Ø§Ù„Ù…Ø¹ÙŠØ´Ø©", icon: "ğŸ›‹ï¸" }
                ],
                sentenceParts: {
                    col1: { title: "Who?", items: ["I am", "Mom is"] },
                    col2: { title: "Where?", items: ["in the"] },
                    col3: { title: "Room", items: ["kitchen", "garden", "bathroom"] }
                }
            },
            // UNIT 20
            {
                id: "unit20", title: { en: "20: Nature", de: "20: Natur", ar: "20: Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©" }, icon: "ğŸŒ³",
                vocab: [
                    { en: "tree", de: "Baum", ar: "Ø´Ø¬Ø±Ø©", icon: "ğŸŒ³" },
                    { en: "flower", de: "Blume", ar: "Ø²Ù‡Ø±Ø©", icon: "ğŸŒ¸" },
                    { en: "sun", de: "Sonne", ar: "Ø´Ù…Ø³", icon: "â˜€ï¸" },
                    { en: "moon", de: "Mond", ar: "Ù‚Ù…Ø±", icon: "ğŸŒ™" }
                ],
                sentenceParts: {
                    col1: { title: "Start", items: ["I see a", "Look at the"] },
                    col2: { title: "Adjective", items: ["big", "beautiful", "green"] },
                    col3: { title: "Object", items: ["tree", "flower", "sun", "moon"] }
                }
            }
        ];

        // ==========================================
        // 3. APP LOGIC
        // ==========================================
        
        const app = {
            currentUnitId: "all_words",
            activeTab: 'list',
            
            // State
            state: {
                sentenceSelection: { col1: null, col2: null, col3: null },
                sentenceInput: "",
                flippedCards: {},
                quizSelection: [], 
                memoryCards: [], memoryFlipped: [], memoryMatched: [], memoryLock: false,
                scrambleWord: null, scrambleInput: ""
            },
            
            data: { sentences: [] },

            init: function() {
                this.loadData();
                this.renderUnitSelector();
                this.setUnit("all_words");
            },

            // --- HELPERS ---
            getAllVocab: function() {
                return COURSE_DATA.flatMap(unit => unit.vocab.map(v => ({...v, unit: unit.title.en})));
            },

            getUnit: function() {
                if (this.currentUnitId === "all_words") {
                    return {
                        id: "all_words",
                        title: { en: "All Words & Games", de: "Alle WÃ¶rter & Spiele", ar: "ÙƒÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨" },
                        icon: "ğŸ“š",
                        vocab: this.getAllVocab(),
                        isSpecial: true
                    };
                }
                return COURSE_DATA.find(u => u.id === this.currentUnitId);
            },

            setUnit: function(id) {
                this.currentUnitId = id;
                this.activeTab = (id === "all_words") ? "list" : "vocab";
                this.state = { 
                    sentenceSelection: {}, sentenceInput: "", flippedCards: {}, quizSelection: [], 
                    memoryCards: [], memoryFlipped: [], memoryMatched: [], memoryLock: false,
                    scrambleWord: null, scrambleInput: ""
                };
                this.refreshQuizSelection();
                this.renderUnitSelector();
                this.render();
            },

            setTab: function(tabId) {
                this.activeTab = tabId;
                if(tabId === 'memory') this.initMemoryGame();
                if(tabId === 'scramble') this.initScrambleGame();
                this.render();
            },

            refreshQuizSelection: function() {
                const unit = this.getUnit();
                if (!unit || !unit.vocab) return;
                const shuffled = [...unit.vocab].sort(() => 0.5 - Math.random());
                this.state.quizSelection = shuffled.slice(0, 3);
            },

            // --- AUDIO (HYBRID MODE) ---
            speak: function(text, lang = 'en-US', key = null) {
                if (key) {
                    const cleanKey = key.toLowerCase().replace(/[^a-z0-9]/g, '_');
                    const suffix = lang.startsWith('ar') ? 'ar' : 'en';
                    const audioPath = `${cleanKey}_${suffix}.mp3`;
                    
                    const audio = new Audio(audioPath);
                    audio.onerror = () => {
                        this.speakTTS(text, lang);
                    };
                    
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(e => {
                            this.speakTTS(text, lang);
                        });
                    }
                    return; 
                }
                this.speakTTS(text, lang);
            },

            speakTTS: function(text, lang) {
                if (!('speechSynthesis' in window)) return;
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = lang;
                u.rate = 0.9;
                
                const voices = window.speechSynthesis.getVoices();
                const mainLang = lang.split('-')[0];
                const voice = voices.find(v => v.lang.startsWith(mainLang));
                if (voice) u.voice = voice;
                
                window.speechSynthesis.speak(u);
            },

            testAudio: function() { this.speak("Hello! Audio is working."); },

            // --- STORAGE ---
            loadData: function() {
                try {
                    const saved = localStorage.getItem('ahmed_app_' + this.currentUnitId);
                    if (saved) this.data = JSON.parse(saved);
                    else this.data = { sentences: [] };
                } catch(e) {}
            },
            saveData: function() {
                try { localStorage.setItem('ahmed_app_' + this.currentUnitId, JSON.stringify(this.data)); } catch(e) {}
            },
            addSentence: function(s) {
                if (!this.data.sentences.includes(s)) { 
                    this.data.sentences.push(s); 
                    this.saveData(); 
                }
            },

            // --- RENDERERS ---
            renderUnitSelector: function() {
                const container = document.getElementById('unit-selector');
                
                // Helper for button content
                const btnContent = (unit, isSpecial=false) => `
                    <button onclick="app.setUnit('${unit.id}')" 
                        class="px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors flex flex-col items-start gap-1 border-2 
                        ${this.currentUnitId === unit.id 
                            ? (isSpecial ? 'bg-yellow-400 text-yellow-900 border-yellow-200 shadow-lg' : 'bg-white text-green-800 border-white shadow-lg') 
                            : 'bg-green-700 text-green-100 border-green-600 hover:bg-green-600'}">
                        <div class="flex items-center gap-2">
                            <span class="text-lg">${unit.icon}</span> 
                            <span>${unit.title.en}</span>
                        </div>
                        <div class="flex flex-col text-[10px] leading-tight opacity-80 w-full items-start">
                            <span>${unit.title.de}</span>
                            <span class="ar text-right w-full">${unit.title.ar}</span>
                        </div>
                    </button>
                `;

                let html = btnContent({
                    id: "all_words",
                    title: UI.btn.allWords,
                    icon: "ğŸ“š"
                }, true);

                html += COURSE_DATA.map(unit => btnContent(unit)).join('');
                container.innerHTML = html;
            },

            renderNav: function(isSpecial) {
                const tabsContainer = document.getElementById('nav-tabs');
                document.getElementById('nav-container').classList.remove('hidden');
                
                let tabs = [];
                if (isSpecial) {
                    tabs = [
                        { id: 'list', label: UI.tabs.vocab, color: 'bg-yellow-500', icon: 'ğŸ“–' }, // Reusing Vocab label logic but icon differs
                        { id: 'memory', label: UI.tabs.memory, color: 'bg-purple-600' },
                        { id: 'scramble', label: UI.tabs.scramble, color: 'bg-yellow-500' }
                    ];
                    // Fix List label manually as it's special
                    tabs[0].label = { en: "List", de: "Liste", ar: "Ù‚Ø§Ø¦Ù…Ø©" };
                } else {
                    tabs = [
                        { id: 'vocab', label: UI.tabs.vocab, color: 'bg-green-600' },
                        { id: 'sentences', label: UI.tabs.sentences, color: 'bg-blue-600' },
                        { id: 'memory', label: UI.tabs.memory, color: 'bg-purple-600' },
                        { id: 'scramble', label: UI.tabs.scramble, color: 'bg-yellow-500' }
                    ];
                }

                tabsContainer.innerHTML = tabs.map(t => `
                    <button onclick="app.setTab('${t.id}')" 
                        class="px-4 py-2 rounded-lg text-sm transition-all shadow-sm flex flex-col items-center leading-none gap-1 min-w-[80px]
                        ${this.activeTab === t.id ? `${t.color} text-white scale-105 shadow-md font-bold` : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}">
                        <span>${t.label.en}</span>
                        <span class="text-[10px] opacity-80">${t.label.de} | <span class="ar">${t.label.ar}</span></span>
                    </button>
                `).join('');
            },

            render: function() {
                const unit = this.getUnit();
                this.renderNav(unit.isSpecial);
                const content = document.getElementById('app-content');

                if (unit.isSpecial) {
                    if (this.activeTab === 'list') this.renderAllList(content, unit);
                    else if (this.activeTab === 'memory') this.renderMemory(content);
                    else if (this.activeTab === 'scramble') this.renderScramble(content);
                } else {
                    if (this.activeTab === 'vocab') this.renderVocab(content, unit);
                    else if (this.activeTab === 'sentences') this.renderSentences(content, unit);
                    else if (this.activeTab === 'memory') this.renderMemory(content);
                    else if (this.activeTab === 'scramble') this.renderScramble(content);
                }
            },

            // --- VIEWS ---

            renderVocab: function(container, unit) {
                const quizHTML = this.state.quizSelection.map((word, idx) => {
                    const masked = word.en.replace(/[aeiouAEIOU]/g, '_');
                    return `
                        <div class="flex flex-col sm:flex-row gap-2 items-center bg-gray-50 p-3 rounded-lg mb-3 border border-gray-200">
                            <span class="font-mono text-xl bg-white border-2 border-gray-300 px-4 py-1 rounded-md w-full sm:w-48 text-center tracking-[0.2em] text-gray-700 font-bold shadow-sm">${masked}</span>
                            <div class="relative w-full flex-grow group">
                                <input type="text" id="quiz-input-${idx}" data-correct="${word.en}" oninput="app.checkQuizInput(this)" 
                                    class="w-full border-2 border-gray-300 p-2 pl-4 rounded-lg outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all font-medium" 
                                    placeholder="..." autocomplete="off">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 opacity-0 transition-opacity text-2xl" id="quiz-icon-${idx}">âœ…</div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="animate-fade-in space-y-8">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-green-500 flex flex-col gap-1">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="bg-green-100 px-2 rounded">Step 1</span> ${UI.tabs.vocab.en}</h2>
                            <p class="text-sm text-gray-600">ğŸ‡©ğŸ‡ª ${UI.instr.vocab.de}</p>
                            <p class="text-sm text-gray-500 ar">ğŸ‡¸ğŸ‡¦ ${UI.instr.vocab.ar}</p>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${unit.vocab.map((word, idx) => `
                                <div onclick="app.toggleCard(${idx})" class="bg-white rounded-xl shadow-sm hover:shadow-lg p-4 border-2 transition-all cursor-pointer ${this.state.flippedCards[idx] ? 'border-green-500 bg-green-50' : 'border-gray-100'}">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-4xl">${word.icon}</span>
                                        <div class="flex gap-2">
                                            <button onclick="event.stopPropagation(); app.speak('${word.ar}', 'ar-SA', '${word.en}')" class="w-10 h-10 flex items-center justify-center bg-orange-100 text-orange-600 rounded-full hover:bg-orange-200">ğŸ‡¸ğŸ‡¦ ğŸ”Š</button>
                                            <button onclick="event.stopPropagation(); app.speak('${word.en.replace(/'/g, "\\'")}', 'en-US', '${word.en}')" class="w-10 h-10 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full hover:bg-blue-200">ğŸ‡¬ğŸ‡§ ğŸ”Š</button>
                                        </div>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-800">${word.en}</h3>
                                    <div class="mt-2 pt-2 border-t border-gray-200 transition-all ${this.state.flippedCards[idx] ? 'opacity-100' : 'opacity-0'}">
                                        <p class="text-green-700 font-bold">${word.de}</p>
                                        <p class="text-gray-500 ar text-lg">${word.ar}</p>
                                    </div>
                                    ${!this.state.flippedCards[idx] ? '<p class="text-[10px] text-gray-400 mt-1 uppercase tracking-wide">Click to translate</p>' : ''}
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                             <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-bold text-gray-800">âš¡ Speed Quiz</h3>
                                <button onclick="app.refreshQuizSelection(); app.render()" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-xs font-bold flex flex-col items-center">
                                    <span>${UI.btn.newWords.en}</span>
                                    <span class="text-[10px] opacity-70">${UI.btn.newWords.de}</span>
                                    <span class="text-[10px] opacity-70 ar">${UI.btn.newWords.ar}</span>
                                </button>
                             </div>
                             ${quizHTML}
                        </div>
                    </div>
                `;
            },

            renderSentences: function(container, unit) {
                const sel = this.state.sentenceSelection;
                const constructedSentence = (sel.col1 && sel.col2 && sel.col3) ? `${sel.col1} ${sel.col2} ${sel.col3}.` : "...";
                const isReady = (sel.col1 && sel.col2 && sel.col3);
                const isTypedCorrectly = this.state.sentenceInput.trim() === constructedSentence;

                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-blue-500 flex flex-col gap-1">
                            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="bg-blue-100 px-2 rounded">Step 2</span> ${UI.tabs.sentences.en}</h2>
                            <p class="text-sm text-gray-600">ğŸ‡©ğŸ‡ª ${UI.instr.sentences.de}</p>
                            <p class="text-sm text-gray-500 ar">ğŸ‡¸ğŸ‡¦ ${UI.instr.sentences.ar}</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${['col1', 'col2', 'col3'].map(col => `
                                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100">
                                    <h3 class="font-bold text-blue-800 mb-2 uppercase text-xs tracking-wider">${unit.sentenceParts[col].title}</h3>
                                    ${unit.sentenceParts[col].items.map(item => `
                                        <button onclick="app.state.sentenceSelection.${col} = '${item}'; app.state.sentenceInput = ''; app.render()" 
                                            class="w-full p-2 mb-2 rounded text-left text-sm transition-all ${sel[col] === item ? 'bg-blue-600 text-white shadow-lg transform scale-105' : 'bg-white hover:bg-blue-100'}">
                                            ${item}
                                        </button>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-gray-800 text-white p-6 rounded-xl shadow-lg">
                             <div class="text-center mb-4">
                                <p class="text-xs text-gray-400 uppercase mb-1">Your Sentence:</p>
                                <div class="text-xl md:text-2xl font-mono min-h-[2rem]">${constructedSentence}</div>
                             </div>

                             ${isReady ? `
                                <div class="mt-4 pt-4 border-t border-gray-600">
                                    <p class="text-sm text-yellow-400 mb-2 text-center">ğŸ‘‡ Type the sentence here / Schreib den Satz / Ø§ÙƒØªØ¨ Ø§Ù„Ø¬Ù…Ù„Ø© ğŸ‘‡</p>
                                    <input type="text" 
                                        value="${this.state.sentenceInput}"
                                        oninput="app.state.sentenceInput = this.value; app.render()"
                                        class="w-full p-3 rounded text-gray-900 text-center font-mono outline-none border-4 ${isTypedCorrectly ? 'border-green-500 bg-green-50' : 'border-gray-500'}" 
                                        placeholder="...">
                                    
                                    ${isTypedCorrectly ? `
                                        <div class="mt-4 text-center">
                                            <button onclick="app.addSentence('${constructedSentence}'); app.state.sentenceSelection={}; app.state.sentenceInput=''; app.speak('Excellent'); app.render()" 
                                                class="bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-8 rounded-full shadow-lg animate-bounce flex flex-col items-center mx-auto">
                                                <span>âœ… ${UI.btn.checkSave.en}</span>
                                                <span class="text-[10px] font-normal">${UI.btn.checkSave.de}</span>
                                                <span class="text-[10px] font-normal ar">${UI.btn.checkSave.ar}</span>
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                             ` : ''}
                        </div>

                        <div class="bg-white p-4 rounded-xl border border-gray-200">
                            <h3 class="font-bold text-gray-500 text-sm mb-3 border-b pb-2">My Saved Sentences:</h3>
                            <div class="space-y-2">
                                ${this.data.sentences.map(s => `
                                    <div class="bg-blue-50 p-2 rounded flex justify-between items-center">
                                        <span class="font-medium text-gray-800">${s}</span>
                                        <button onclick="app.speak('${s.replace(/'/g, "\\'")}')" class="text-blue-500 hover:bg-blue-100 p-1 rounded">ğŸ”Š</button>
                                    </div>
                                `).join('')}
                                ${this.data.sentences.length === 0 ? '<p class="text-xs text-gray-400 italic">No sentences yet.</p>' : ''}
                            </div>
                        </div>
                    </div>`;
                
                if (isReady && !isTypedCorrectly && document.querySelector('input')) {
                    setTimeout(() => document.querySelector('input').focus(), 10);
                }
            },

            renderAllList: function(container, unit) {
                container.innerHTML = `
                    <div class="bg-white rounded-xl shadow overflow-hidden animate-fade-in">
                        <div class="p-4 bg-yellow-400 text-yellow-900 font-bold flex justify-between items-center">
                            <div>
                                <span class="block text-lg">WÃ¶rterliste (${unit.vocab.length} Words)</span>
                                <span class="text-xs opacity-75">${UI.instr.list.ar}</span>
                            </div>
                            <span class="text-2xl">ğŸ“–</span>
                        </div>
                        <div class="divide-y divide-gray-100 max-h-[70vh] overflow-y-auto">
                            ${unit.vocab.map(w => `
                                <div class="p-3 flex items-center justify-between hover:bg-yellow-50 cursor-pointer" onclick="app.speak('${w.en.replace(/'/g, "\\'")}')">
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">${w.icon}</span>
                                        <div>
                                            <div class="font-bold text-gray-800">${w.en}</div>
                                            <div class="text-xs text-gray-500">${w.unit}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-gray-600">${w.de}</div>
                                        <div class="text-sm text-gray-400 ar">${w.ar}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderMemory: function(container) {
                if(this.state.memoryCards.length === 0) this.initMemoryGame();
                container.innerHTML = `
                    <div class="space-y-4 animate-fade-in">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-purple-500 flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="bg-purple-100 px-2 rounded">Step 3</span> ${UI.tabs.memory.en}</h2>
                                <p class="text-sm text-gray-600">ğŸ‡©ğŸ‡ª ${UI.instr.memory.de}</p>
                                <p class="text-sm text-gray-500 ar">ğŸ‡¸ğŸ‡¦ ${UI.instr.memory.ar}</p>
                            </div>
                            <button onclick="app.initMemoryGame(); app.render()" class="bg-purple-600 text-white px-3 py-2 rounded-lg text-xs font-bold shadow hover:bg-purple-700 flex flex-col items-center">
                                <span>ğŸ”„ ${UI.btn.restart.en}</span>
                                <span class="text-[10px] opacity-80">${UI.btn.restart.de} | <span class="ar">${UI.btn.restart.ar}</span></span>
                            </button>
                        </div>
                        <div class="grid grid-cols-3 sm:grid-cols-4 gap-3">
                            ${this.state.memoryCards.map((card, idx) => {
                                const isFlipped = this.state.memoryFlipped.includes(idx) || this.state.memoryMatched.includes(card.matchId);
                                const isMatched = this.state.memoryMatched.includes(card.matchId);
                                return `
                                    <div onclick="app.flipMemoryCard(${idx})" class="perspective h-24 cursor-pointer group">
                                        <div class="relative w-full h-full duration-500 preserve-3d ${isFlipped ? 'rotate-y-180' : ''}" style="transition: transform 0.6s;">
                                            <div class="absolute w-full h-full bg-purple-600 rounded-xl flex items-center justify-center text-white text-3xl shadow-md backface-hidden" style="backface-visibility: hidden;">â“</div>
                                            <div class="absolute w-full h-full ${isMatched ? 'bg-green-100 border-green-500' : 'bg-white'} border-2 rounded-xl flex flex-col items-center justify-center shadow-md backface-hidden" style="transform: rotateY(180deg); backface-visibility: hidden;">
                                                <span class="text-2xl">${card.icon}</span>
                                                <span class="font-bold text-center text-xs sm:text-sm p-1 leading-tight">${card.text}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            },

            renderScramble: function(container) {
                if (!this.state.scrambleWord) this.initScrambleGame();
                const word = this.state.scrambleWord;
                const scrambled = word.en.split('').sort(() => 0.5 - Math.random()).join(' ');
                const isCorrect = this.state.scrambleInput.toLowerCase().trim() === word.en.toLowerCase();

                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white p-4 rounded-2xl shadow-sm border-l-8 border-yellow-500 flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2"><span class="bg-yellow-100 px-2 rounded">Step 4</span> ${UI.tabs.scramble.en}</h2>
                                <p class="text-sm text-gray-600">ğŸ‡©ğŸ‡ª ${UI.instr.scramble.de}</p>
                                <p class="text-sm text-gray-500 ar">ğŸ‡¸ğŸ‡¦ ${UI.instr.scramble.ar}</p>
                            </div>
                        </div>

                        <div class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl text-center border border-gray-100">
                            <div class="text-6xl mb-4 animate-bounce">${word.icon}</div>
                            
                            <div class="bg-yellow-50 p-4 rounded-xl mb-6 border border-yellow-200">
                                <p class="text-yellow-800 font-mono text-3xl tracking-widest font-bold">${scrambled}</p>
                            </div>

                            <input type="text" oninput="app.checkScramble(this.value)" value="${this.state.scrambleInput}"
                                class="w-full text-center text-2xl p-3 border-b-4 ${isCorrect ? 'border-green-500 bg-green-50' : 'border-gray-300 focus:border-yellow-500'} outline-none transition-all placeholder-gray-300 mb-4"
                                placeholder="..." autofocus>
                            
                            ${isCorrect ? 
                                `<div class="text-green-600 font-bold text-xl">âœ… Correct! Next...</div>` : 
                                `<div class="text-gray-400 text-sm flex justify-between px-4"><span>ğŸ‡©ğŸ‡ª ${word.de}</span><span class="ar">ğŸ‡¸ğŸ‡¦ ${word.ar}</span></div>`
                            }
                            
                            <button onclick="app.initScrambleGame(); app.render()" class="mt-8 text-gray-400 text-xs hover:text-gray-600 underline flex flex-col items-center w-full">
                                <span>â© ${UI.btn.skip.en}</span>
                                <span>${UI.btn.skip.de} | <span class="ar">${UI.btn.skip.ar}</span></span>
                            </button>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    const inp = container.querySelector('input');
                    if(inp && !isCorrect) { inp.focus(); inp.setSelectionRange(inp.value.length, inp.value.length); }
                }, 50);
            },
            
            toggleCard: function(idx) {
                this.state.flippedCards[idx] = !this.state.flippedCards[idx];
                this.render();
            },
            
            checkQuizInput: function(inputEl) {
                const val = inputEl.value.trim().toLowerCase();
                const correct = inputEl.dataset.correct.toLowerCase();
                const icon = document.getElementById(inputEl.id.replace('input', 'icon'));
                if (val === correct) {
                    inputEl.className = "w-full border-2 border-green-500 bg-green-50 text-green-800 p-2 pl-4 rounded-lg outline-none font-medium";
                    icon.style.opacity = '1';
                } else {
                    icon.style.opacity = '0';
                }
            },

            // HELPER Methods for Games
            initMemoryGame: function() {
                const unit = this.getUnit();
                let pool = unit.vocab;
                if (pool.length < 6) pool = [...pool, ...pool].slice(0,6);
                else pool = pool.slice(0,6);

                let cards = [];
                pool.forEach((w, i) => {
                    cards.push({ id: i + 'a', type: 'en', text: w.en, matchId: i, icon: w.icon });
                    cards.push({ id: i + 'b', type: 'de', text: w.de, matchId: i, icon: '' }); 
                });
                this.state.memoryCards = cards.sort(() => 0.5 - Math.random());
                this.state.memoryFlipped = [];
                this.state.memoryMatched = [];
                this.state.memoryLock = false;
            },

            flipMemoryCard: function(idx) {
                if (this.state.memoryLock) return;
                if (this.state.memoryFlipped.includes(idx)) return;
                if (this.state.memoryMatched.includes(this.state.memoryCards[idx].matchId)) return;

                this.state.memoryFlipped.push(idx);
                this.render();

                if (this.state.memoryFlipped.length === 2) {
                    this.state.memoryLock = true;
                    const c1 = this.state.memoryCards[this.state.memoryFlipped[0]];
                    const c2 = this.state.memoryCards[this.state.memoryFlipped[1]];

                    if (c1.matchId === c2.matchId) {
                        this.state.memoryMatched.push(c1.matchId);
                        this.state.memoryFlipped = [];
                        this.state.memoryLock = false;
                        this.speak("Correct!");
                        this.render();
                    } else {
                        setTimeout(() => {
                            this.state.memoryFlipped = [];
                            this.state.memoryLock = false;
                            this.render();
                        }, 1000);
                    }
                }
            },
            
            initScrambleGame: function() {
                const unit = this.getUnit();
                this.state.scrambleWord = unit.vocab[Math.floor(Math.random() * unit.vocab.length)];
                this.state.scrambleInput = "";
            },

            checkScramble: function(val) {
                this.state.scrambleInput = val;
                if (val.toLowerCase().trim() === this.state.scrambleWord.en.toLowerCase()) {
                    this.speak("Great job!");
                    setTimeout(() => {
                        this.initScrambleGame();
                        this.render();
                    }, 1500);
                } else {
                    this.render(); 
                }
            }
        };

        app.init();
    </script>
</body>
</html>
