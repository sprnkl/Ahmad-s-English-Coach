<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahmads English App</title>
    
    <!-- Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0fdf4; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .ar { font-family: 'Segoe UI', Tahoma, sans-serif; direction: rtl; }
        
        /* Animationen f√ºr Spiele */
        .card-flip { transition: transform 0.6s; transform-style: preserve-3d; }
        .card-flip.flipped { transform: rotateY(180deg); }
        .perspective { perspective: 1000px; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
    </style>
</head>
<body class="bg-green-50 text-gray-800">

    <!-- HEADER -->
    <div class="bg-green-800 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex flex-col gap-4">
            <div class="flex justify-between items-center">
                <h1 class="text-xl font-bold flex items-center gap-2">üá¨üáß Ahmads English App</h1>
                <button onclick="app.testAudio()" class="bg-green-700 hover:bg-green-600 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2 border border-green-500">
                    üîä Audio Test
                </button>
            </div>
            
            <!-- Unit Selector -->
            <div id="unit-selector" class="flex overflow-x-auto gap-2 bg-green-900/50 p-2 rounded-lg hide-scroll">
                <!-- Units werden hier generiert -->
            </div>
        </div>
    </div>

    <!-- NAVIGATION TABS (werden dynamisch je nach Modul angezeigt) -->
    <div id="nav-container" class="bg-white/90 backdrop-blur border-b border-green-100 p-2 mb-6 shadow-sm hidden">
        <div id="nav-tabs" class="max-w-4xl mx-auto flex justify-center gap-2 overflow-x-auto hide-scroll">
            <!-- Tabs kommen hier rein -->
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <div id="app-content" class="container mx-auto max-w-3xl p-4 min-h-[60vh] pb-20"></div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // ==========================================
        // DATEN
        // ==========================================
        const COURSE_DATA = [
            {
                id: "unit1",
                title: "1: Holidays",
                icon: "üå¥",
                vocab: [
                    { en: "played football", de: "Fu√üball gespielt", ar: "ŸÑÿπÿ® ŸÉÿ±ÿ© ÿßŸÑŸÇÿØŸÖ", icon: "‚öΩ" },
                    { en: "watched TV", de: "ferngesehen", ar: "ÿ¥ÿßŸáÿØ ÿßŸÑÿ™ŸÑŸÅÿßÿ≤", icon: "üì∫" },
                    { en: "slept long", de: "lange geschlafen", ar: "ŸÜÿßŸÖ ÿ∑ŸàŸäŸÑÿßŸã", icon: "üò¥" },
                    { en: "met friends", de: "Freunde getroffen", ar: "ŸÇÿßÿ®ŸÑ ÿßŸÑÿ£ÿµÿØŸÇÿßÿ°", icon: "ü§ù" },
                    { en: "played video games", de: "Videospiele gespielt", ar: "ŸÑÿπÿ® ÿ£ŸÑÿπÿßÿ® ÿßŸÑŸÅŸäÿØŸäŸà", icon: "üéÆ" },
                    { en: "ate pizza", de: "Pizza gegessen", ar: "ÿ£ŸÉŸÑ ÿßŸÑÿ®Ÿäÿ™ÿ≤ÿß", icon: "üçï" },
                    { en: "went to the park", de: "in den Park gegangen", ar: "ÿ∞Ÿáÿ® ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿØŸäŸÇÿ©", icon: "üå≥" },
                    { en: "listened to music", de: "Musik geh√∂rt", ar: "ÿßÿ≥ÿ™ŸÖÿπ ÿ•ŸÑŸâ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ", icon: "üéß" }
                ],
                sentenceParts: {
                    col1: { title: "When?", items: ["In the holidays"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["played football", "watched TV", "met friends", "slept long", "ate pizza", "went to the park"] }
                },
                opinions: [
                    { en: "cool", de: "cool / toll", ar: "ÿ±ÿßÿ¶ÿπ", type: "pos" },
                    { en: "fun", de: "spa√üig", ar: "ŸÖŸÖÿ™ÿπ", type: "pos" },
                    { en: "ok", de: "okay", ar: "ÿ≠ÿ≥ŸÜÿßŸã", type: "neu" },
                    { en: "boring", de: "langweilig", ar: "ŸÖŸÖŸÑ", type: "neg" }
                ]
            },
            {
                id: "unit2",
                title: "2: Hobbies",
                icon: "üéÆ",
                vocab: [
                    { en: "read comics", de: "Comics lesen", ar: "ŸÇÿ±ÿ£ ÿßŸÑŸÇÿµÿµ ÿßŸÑŸÖÿµŸàÿ±ÿ©", icon: "üìö" },
                    { en: "ride a bike", de: "Fahrrad fahren", ar: "ÿ±ŸÉÿ® ÿØÿ±ÿßÿ¨ÿ©", icon: "üö≤" },
                    { en: "swim", de: "schwimmen", ar: "ÿ≥ÿ®ÿ≠", icon: "üèä" },
                    { en: "draw pictures", de: "Bilder malen", ar: "ÿ±ÿ≥ŸÖ ÿµŸàÿ±ÿßŸã", icon: "üé®" },
                    { en: "play cards", de: "Karten spielen", ar: "ŸÑÿπÿ® ÿßŸÑŸàÿ±ŸÇ", icon: "üÉè" },
                    { en: "dance", de: "tanzen", ar: "ÿ±ŸÇÿµ", icon: "üíÉ" }
                ],
                sentenceParts: {
                    col1: { title: "How often?", items: ["Every day", "Sometimes", "Never"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["read comics", "ride my bike", "swim", "draw pictures", "play cards"] }
                },
                opinions: [
                    { en: "great", de: "gro√üartig", ar: "ÿπÿ∏ŸäŸÖ", type: "pos" },
                    { en: "fun", de: "spa√üig", ar: "ŸÖŸÖÿ™ÿπ", type: "pos" },
                    { en: "okay", de: "okay", ar: "ÿ≠ÿ≥ŸÜÿßŸã", type: "neu" },
                    { en: "stupid", de: "bl√∂d", ar: "ÿ∫ÿ®Ÿä", type: "neg" }
                ]
            },
            {
                id: "unit3",
                title: "3: School",
                icon: "üè´",
                vocab: [
                    { en: "Math", de: "Mathe", ar: "ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™", icon: "üìê" },
                    { en: "English", de: "Englisch", ar: "ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä", icon: "üá¨üáß" },
                    { en: "History", de: "Geschichte", ar: "ÿ™ÿßÿ±ŸäÿÆ", icon: "üèõÔ∏è" },
                    { en: "Art", de: "Kunst", ar: "ŸÅŸÜ", icon: "üé®" },
                    { en: "Pen", de: "Stift", ar: "ŸÇŸÑŸÖ", icon: "üñäÔ∏è" },
                    { en: "Bag", de: "Tasche", ar: "ÿ≠ŸÇŸäÿ®ÿ©", icon: "üéí" }
                ],
                sentenceParts: {
                    col1: { title: "When?", items: ["On Monday", "On Tuesday"] },
                    col2: { title: "Who?", items: ["I"] },
                    col3: { title: "What?", items: ["have Math", "have English", "have History"] }
                },
                opinions: [
                    { en: "easy", de: "einfach", ar: "ÿ≥ŸáŸÑ", type: "pos" },
                    { en: "hard", de: "schwer", ar: "ÿµÿπÿ®", type: "neg" }
                ]
            },
            {
                id: "unit4",
                title: "4: Town",
                icon: "üèôÔ∏è",
                vocab: [
                    { en: "Cinema", de: "Kino", ar: "ÿ≥ŸäŸÜŸÖÿß", icon: "üçø" },
                    { en: "Park", de: "Park", ar: "ÿ≠ÿØŸäŸÇÿ©", icon: "üå≥" },
                    { en: "Go left", de: "Geh links", ar: "ÿßÿ∞Ÿáÿ® ŸÑŸÑŸäÿ≥ÿßÿ±", icon: "‚¨ÖÔ∏è" },
                    { en: "Go right", de: "Geh rechts", ar: "ÿßÿ∞Ÿáÿ® ŸÑŸÑŸäŸÖŸäŸÜ", icon: "‚û°Ô∏è" },
                    { en: "Go straight", de: "Geh geradeaus", ar: "ÿßÿ∞Ÿáÿ® ŸÑŸÑÿ£ŸÖÿßŸÖ", icon: "‚¨ÜÔ∏è" }
                ],
                sentenceParts: {
                    col1: { title: "Where?", items: ["To the cinema", "To the park"] },
                    col2: { title: "Please...", items: ["go left", "go right"] },
                    col3: { title: "Distance", items: ["and stop", "for 100 meters"] }
                },
                opinions: [
                    { en: "near", de: "nah", ar: "ŸÇÿ±Ÿäÿ®", type: "pos" },
                    { en: "far", de: "weit", ar: "ÿ®ÿπŸäÿØ", type: "neu" }
                ]
            }
        ];

        // ==========================================
        // APP LOGIC
        // ==========================================
        
        const app = {
            currentUnitId: "all_words", // Start mit All Words
            activeTab: 'list',
            
            // State
            state: {
                sentenceSelection: { col1: null, col2: null, col3: null },
                flippedCards: {},
                quizSelection: [], // F√ºr das Speed Quiz (3 zuf√§llige W√∂rter)
                
                // Memory Game State
                memoryCards: [],
                memoryFlipped: [],
                memoryMatched: [],
                memoryLock: false,

                // Scramble Game State
                scrambleWord: null,
                scrambleInput: ""
            },
            
            data: { sentences: [], opinions: {} },

            init: function() {
                this.loadData();
                this.renderUnitSelector();
                this.setUnit("all_words"); // Default Unit
            },

            // --- HELPER: GET ALL VOCAB ---
            getAllVocab: function() {
                return COURSE_DATA.flatMap(unit => unit.vocab.map(v => ({...v, unit: unit.title})));
            },

            getUnit: function() {
                if (this.currentUnitId === "all_words") {
                    return {
                        id: "all_words",
                        title: "Alle W√∂rter & Spiele",
                        icon: "üìö",
                        vocab: this.getAllVocab(),
                        isSpecial: true
                    };
                }
                return COURSE_DATA.find(u => u.id === this.currentUnitId);
            },

            setUnit: function(id) {
                this.currentUnitId = id;
                // Standard Tab Logik
                if (id === "all_words") this.activeTab = "list";
                else this.activeTab = "vocab";
                
                this.state = { 
                    sentenceSelection: {}, flippedCards: {}, quizSelection: [], 
                    memoryCards: [], memoryFlipped: [], memoryMatched: [], memoryLock: false,
                    scrambleWord: null, scrambleInput: ""
                };
                
                this.loadData();
                this.refreshQuizSelection(); // Initial Quiz Selection
                this.renderUnitSelector();
                this.render();
            },

            setTab: function(tabId) {
                this.activeTab = tabId;
                if(tabId === 'memory') this.initMemoryGame();
                if(tabId === 'scramble') this.initScrambleGame();
                this.render();
            },

            refreshQuizSelection: function() {
                const unit = this.getUnit();
                if (!unit || !unit.vocab) return;
                // W√§hle 3 zuf√§llige W√∂rter
                const shuffled = [...unit.vocab].sort(() => 0.5 - Math.random());
                this.state.quizSelection = shuffled.slice(0, 3);
            },

            // --- SPEICHERN ---
            loadData: function() {
                try {
                    const saved = localStorage.getItem('english_data_' + this.currentUnitId);
                    if (saved) { this.data = JSON.parse(saved); } else { this.data = { sentences: [], opinions: {} }; }
                } catch(e) {}
            },
            saveData: function() {
                try { localStorage.setItem('english_data_' + this.currentUnitId, JSON.stringify(this.data)); } catch(e) {}
            },
            addSentence: function(s) {
                if (!this.data.sentences.includes(s)) { this.data.sentences.push(s); this.saveData(); }
            },
            addOpinion: function(a, o) {
                this.data.opinions[a] = o; this.saveData();
            },

            // --- AUDIO ---
            speak: function(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'en-US'; u.rate = 0.9;
                    window.speechSynthesis.speak(u);
                }
            },
            testAudio: function() { this.speak("Hello! Audio is working."); },

            // --- UI RENDERERS ---
            renderUnitSelector: function() {
                const container = document.getElementById('unit-selector');
                let html = `
                    <button onclick="app.setUnit('all_words')" 
                        class="px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap transition-colors flex items-center gap-2 border-2 
                        ${this.currentUnitId === 'all_words' ? 'bg-yellow-400 text-yellow-900 border-yellow-200 shadow-lg' : 'bg-green-700 text-green-100 border-green-600 hover:bg-green-600'}">
                        <span>üìö</span> <span>Alle W√∂rter & Spiele</span>
                    </button>
                `;
                html += COURSE_DATA.map(unit => `
                    <button onclick="app.setUnit('${unit.id}')" 
                        class="px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap transition-colors flex items-center gap-2 border-2 
                        ${this.currentUnitId === unit.id ? 'bg-white text-green-800 border-white shadow-lg' : 'bg-green-700 text-green-100 border-green-600 hover:bg-green-600'}">
                        <span>${unit.icon}</span> <span>${unit.title}</span>
                    </button>
                `).join('');
                container.innerHTML = html;
            },

            renderNav: function(isSpecial) {
                const container = document.getElementById('nav-container');
                const tabsContainer = document.getElementById('nav-tabs');
                container.classList.remove('hidden');
                
                let tabs = [];
                if (isSpecial) {
                    tabs = [
                        { id: 'list', label: 'üìñ Liste', color: 'bg-yellow-500' },
                        { id: 'memory', label: 'üïπÔ∏è Memory', color: 'bg-purple-500' },
                        { id: 'scramble', label: 'üß© Scramble', color: 'bg-blue-500' }
                    ];
                } else {
                    tabs = [
                        { id: 'vocab', label: '1. Words', color: 'bg-green-600' },
                        { id: 'sentences', label: '2. Sentences', color: 'bg-blue-600' },
                        { id: 'opinion', label: '3. Opinion', color: 'bg-purple-600' },
                        { id: 'report', label: '4. Report', color: 'bg-gray-600' }
                    ];
                }

                tabsContainer.innerHTML = tabs.map(t => `
                    <button onclick="app.setTab('${t.id}')" 
                        class="px-4 py-2 rounded-lg font-bold text-sm transition-all shadow-sm ${this.activeTab === t.id ? `${t.color} text-white scale-105 shadow-md` : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}">
                        ${t.label}
                    </button>
                `).join('');
            },

            render: function() {
                const unit = this.getUnit();
                this.renderNav(unit.isSpecial);
                const content = document.getElementById('app-content');

                if (unit.isSpecial) {
                    // SPECIAL UNIT VIEWS
                    if (this.activeTab === 'list') this.renderAllList(content, unit);
                    else if (this.activeTab === 'memory') this.renderMemory(content);
                    else if (this.activeTab === 'scramble') this.renderScramble(content);
                } else {
                    // STANDARD UNIT VIEWS
                    if (this.activeTab === 'vocab') this.renderVocab(content, unit);
                    else if (this.activeTab === 'sentences') this.renderSentences(content, unit);
                    else if (this.activeTab === 'opinion') this.renderOpinion(content, unit);
                    else if (this.activeTab === 'report') this.renderReport(content, unit);
                }
            },

            // --- STANDARD VIEWS ---

            renderVocab: function(container, unit) {
                // Quiz Section HTML generator (NUR HTML, keine Logik hier)
                const quizHTML = this.state.quizSelection.map((word, idx) => {
                    // Maskieren: Vokale weg
                    const masked = word.en.replace(/[aeiouAEIOU]/g, '_');
                    return `
                        <div class="flex flex-col sm:flex-row gap-2 items-center bg-gray-50 p-3 rounded-lg mb-3 border border-gray-200">
                            <span class="font-mono text-xl bg-white border-2 border-gray-300 px-4 py-1 rounded-md w-full sm:w-48 text-center tracking-[0.2em] text-gray-700 font-bold shadow-sm">${masked}</span>
                            <div class="relative w-full flex-grow group">
                                <input type="text" 
                                    id="quiz-input-${idx}"
                                    data-correct="${word.en}"
                                    oninput="app.checkQuizInput(this)" 
                                    class="w-full border-2 border-gray-300 p-2 pl-4 rounded-lg outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all font-medium" 
                                    placeholder="Ganzes Wort..." autocomplete="off">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 opacity-0 transition-opacity" id="quiz-icon-${idx}">
                                    <span class="text-2xl">‚úÖ</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="animate-fade-in space-y-8">
                        <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-green-500">
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Step 1: Words</h2>
                            <p class="text-gray-600 mb-1">üá©üá™ Klicke auf die Karte. H√∂re das Wort.</p>
                            <p class="text-gray-400 text-sm ar">üá∏üá¶ ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©. ÿßÿ≥ÿ™ŸÖÿπ ŸÑŸÑŸÉŸÑŸÖÿ©.</p>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${unit.vocab.map((word, idx) => `
                                <div onclick="app.toggleCard(${idx})" 
                                     class="bg-white rounded-xl shadow-sm hover:shadow-lg p-6 cursor-pointer border-2 transition-all transform hover:-translate-y-1 duration-200 group 
                                     ${this.state.flippedCards[idx] ? 'border-green-500 bg-green-50' : 'border-gray-100'}">
                                    <div class="flex justify-between items-start mb-4">
                                        <span class="text-5xl filter drop-shadow-sm">${word.icon}</span>
                                        <button onclick="event.stopPropagation(); app.speak('${word.en.replace(/'/g, "\\'")}')" 
                                            class="w-12 h-12 flex items-center justify-center bg-blue-50 rounded-full text-blue-600 hover:bg-blue-600 hover:text-white transition-colors shadow-sm">
                                            üîä
                                        </button>
                                    </div>
                                    <h3 class="text-2xl font-bold text-gray-800 mb-1">${word.en}</h3>
                                    
                                    <div class="transition-all duration-300 overflow-hidden ${this.state.flippedCards[idx] ? 'max-h-24 opacity-100 mt-3 pt-3 border-t border-green-200' : 'max-h-0 opacity-0'}">
                                        <p class="text-green-700 font-bold text-lg">${word.de}</p>
                                        <p class="text-gray-500 ar text-lg mt-1">${word.ar}</p>
                                    </div>
                                    ${!this.state.flippedCards[idx] ? '<p class="text-xs text-gray-400 mt-2 font-medium uppercase tracking-wide">Click to translate</p>' : ''}
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                             <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">‚ö° Speed Quiz <span class="text-sm font-normal text-gray-500">(F√ºlle die L√ºcken)</span></h3>
                                <button onclick="app.refreshQuizAndRender()" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-sm font-bold flex items-center gap-1 transition-colors">
                                    üîÑ Neue W√∂rter
                                </button>
                             </div>
                             ${quizHTML}
                        </div>
                    </div>
                `;
            },

            // NEU: Direkte DOM Manipulation f√ºr fl√ºssiges Tippen ohne Fokus-Verlust
            checkQuizInput: function(inputEl) {
                const val = inputEl.value.trim().toLowerCase();
                const correct = inputEl.dataset.correct.toLowerCase();
                const icon = document.getElementById(inputEl.id.replace('input', 'icon'));
                
                if (val === correct) {
                    inputEl.classList.remove('border-gray-300', 'focus:border-blue-500', 'border-red-300', 'bg-red-50');
                    inputEl.classList.add('border-green-500', 'bg-green-50', 'text-green-800');
                    icon.style.opacity = '1';
                } else if (val.length > 2) {
                    inputEl.classList.add('border-red-300', 'bg-red-50');
                } else {
                    inputEl.classList.remove('border-green-500', 'bg-green-50', 'text-green-800', 'border-red-300', 'bg-red-50');
                    inputEl.classList.add('border-gray-300');
                    icon.style.opacity = '0';
                }
            },

            refreshQuizAndRender: function() {
                this.refreshQuizSelection();
                this.render(); // Hier ist Re-Render okay, weil wir neue W√∂rter wollen
            },

            toggleCard: function(idx) {
                this.state.flippedCards[idx] = !this.state.flippedCards[idx];
                this.render(); 
            },

            // --- SENTENCES & OPINION & REPORT (Keep existing logic mostly, simplified render) ---
            renderSentences: function(container, unit) {
                const sel = this.state.sentenceSelection;
                const isComplete = sel.col1 && sel.col2 && sel.col3;
                container.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                            <h2 class="text-xl font-bold">Step 2: Sentences</h2>
                            <p class="text-sm text-gray-600">üá©üá™ W√§hle aus jeder Spalte. Baue einen Satz.</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${['col1', 'col2', 'col3'].map(col => `
                                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                    <h3 class="font-bold text-blue-800 mb-2 uppercase text-xs">${unit.sentenceParts[col].title}</h3>
                                    ${unit.sentenceParts[col].items.map(item => `
                                        <button onclick="app.state.sentenceSelection.${col} = '${item}'; app.render()" 
                                            class="w-full p-2 mb-2 rounded text-left text-sm transition-all ${sel[col] === item ? 'bg-blue-600 text-white shadow-lg transform scale-105' : 'bg-white hover:bg-blue-100'}">
                                            ${item}
                                        </button>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-gray-800 text-white p-6 rounded-xl text-center shadow-lg">
                             <div class="text-xl mb-4 font-mono">
                                <span class="${sel.col1 ? 'text-blue-300' : 'text-gray-500'}">${sel.col1 || '...'}</span>
                                <span class="${sel.col2 ? 'text-purple-300' : 'text-gray-500'}">${sel.col2 || '...'}</span>
                                <span class="${sel.col3 ? 'text-orange-300' : 'text-gray-500'}">${sel.col3 || '...'}</span>.
                             </div>
                             ${isComplete ? `<button onclick="app.addSentence('${sel.col1} ${sel.col2} ${sel.col3}.'); app.state.sentenceSelection={}; app.speak('Excellent'); app.render()" class="bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-6 rounded-full shadow-lg animate-bounce">Save It</button>` : ''}
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-500 text-sm mb-2">Saved Sentences:</h3>
                            ${this.data.sentences.map(s => `<div class="bg-white p-2 rounded mb-1 shadow-sm flex justify-between"><span>${s}</span><button onclick="app.speak('${s.replace(/'/g, "\\'")}')">üîä</button></div>`).join('')}
                        </div>
                    </div>`;
            },

            renderOpinion: function(container, unit) {
                container.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-purple-500">
                            <h2 class="text-xl font-bold">Step 3: Opinion</h2>
                            <p class="text-sm text-gray-600">üá©üá™ Wie findest du das? W√§hle.</p>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            ${unit.opinions.map(op => `
                                <div onclick="app.speak('${op.en}')" class="p-3 rounded-lg text-center border bg-white hover:shadow-md cursor-pointer">
                                    <div class="font-bold text-lg">${op.en}</div>
                                    <div class="text-xs text-gray-500">${op.de} / ${op.ar}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow border">
                            ${unit.vocab.slice(0,5).map(v => `
                                <div class="flex justify-between items-center border-b last:border-0 py-2">
                                    <span class="font-medium">${v.en} was...</span>
                                    <div class="flex gap-1">
                                        ${unit.opinions.map(op => `
                                            <button onclick="app.addOpinion('${v.en}', '${op.en}'); app.speak('${v.en} was ${op.en}'); app.render()" 
                                                class="px-2 py-1 text-xs rounded border ${this.data.opinions[v.en]===op.en ? 'bg-purple-600 text-white' : 'hover:bg-gray-50'}">${op.en}</button>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
            },

            renderReport: function(container, unit) {
                container.innerHTML = `
                    <div class="bg-white p-8 rounded-xl shadow-2xl">
                        <h1 class="text-3xl font-bold mb-4 border-b pb-2">My English Report</h1>
                        <input class="text-2xl w-full border-b mb-6 outline-none" placeholder="My Name...">
                        <div class="space-y-4">
                            <h3 class="font-bold">Sentences:</h3>
                            <ul class="list-disc pl-5">${this.data.sentences.map(s => `<li>${s}</li>`).join('')}</ul>
                            <h3 class="font-bold">Opinions:</h3>
                            <ul class="list-disc pl-5">${Object.entries(this.data.opinions).map(([k,v]) => `<li>${k} was ${v}</li>`).join('')}</ul>
                        </div>
                        <button onclick="window.print()" class="mt-8 bg-gray-800 text-white px-6 py-3 rounded-lg w-full">Print</button>
                    </div>`;
            },

            // --- SPECIAL UNIT VIEWS ---

            renderAllList: function(container, unit) {
                container.innerHTML = `
                    <div class="bg-white rounded-xl shadow overflow-hidden">
                        <div class="p-4 bg-yellow-400 text-yellow-900 font-bold flex justify-between">
                            <span>W√∂rterliste (${unit.vocab.length} Words)</span>
                            <span>üìñ</span>
                        </div>
                        <div class="divide-y divide-gray-100 max-h-[70vh] overflow-y-auto">
                            ${unit.vocab.map(w => `
                                <div class="p-3 flex items-center justify-between hover:bg-yellow-50" onclick="app.speak('${w.en.replace(/'/g, "\\'")}')">
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">${w.icon}</span>
                                        <div>
                                            <div class="font-bold text-gray-800">${w.en}</div>
                                            <div class="text-xs text-gray-500">${w.unit}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-gray-600">${w.de}</div>
                                        <div class="text-sm text-gray-400 ar">${w.ar}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            // GAME 1: MEMORY
            initMemoryGame: function() {
                const all = this.getAllVocab();
                // Nimm 6 zuf√§llige Paare
                const selection = [...all].sort(() => 0.5 - Math.random()).slice(0, 6);
                
                // Erstelle Karten (En und De getrennt)
                let cards = [];
                selection.forEach((w, i) => {
                    cards.push({ id: i, type: 'en', text: w.en, matchId: i, icon: w.icon });
                    cards.push({ id: i, type: 'de', text: w.de, matchId: i, icon: '' }); // Deutsch ohne Icon, damit es schwerer ist? Oder mit? Machen wir ohne.
                });
                
                // Mischen
                this.state.memoryCards = cards.sort(() => 0.5 - Math.random());
                this.state.memoryFlipped = [];
                this.state.memoryMatched = [];
                this.state.memoryLock = false;
            },

            flipMemoryCard: function(idx) {
                if (this.state.memoryLock) return;
                if (this.state.memoryFlipped.includes(idx)) return; // Schon offen
                if (this.state.memoryMatched.includes(this.state.memoryCards[idx].matchId)) return; // Schon gel√∂st

                this.state.memoryFlipped.push(idx);
                this.render();

                if (this.state.memoryFlipped.length === 2) {
                    this.state.memoryLock = true;
                    const c1 = this.state.memoryCards[this.state.memoryFlipped[0]];
                    const c2 = this.state.memoryCards[this.state.memoryFlipped[1]];

                    if (c1.matchId === c2.matchId) {
                        // Match!
                        this.state.memoryMatched.push(c1.matchId);
                        this.state.memoryFlipped = [];
                        this.state.memoryLock = false;
                        this.speak("Correct!");
                        this.render();
                    } else {
                        // Kein Match
                        setTimeout(() => {
                            this.state.memoryFlipped = [];
                            this.state.memoryLock = false;
                            this.render();
                        }, 1000);
                    }
                }
            },

            renderMemory: function(container) {
                container.innerHTML = `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-purple-100 p-4 rounded-lg text-purple-800">
                            <h2 class="font-bold">üïπÔ∏è Memory Game</h2>
                            <button onclick="app.initMemoryGame(); app.render()" class="bg-purple-600 text-white px-3 py-1 rounded shadow text-sm">Neu starten</button>
                        </div>
                        <div class="grid grid-cols-3 sm:grid-cols-4 gap-3">
                            ${this.state.memoryCards.map((card, idx) => {
                                const isFlipped = this.state.memoryFlipped.includes(idx) || this.state.memoryMatched.includes(card.matchId);
                                const isMatched = this.state.memoryMatched.includes(card.matchId);
                                return `
                                    <div onclick="app.flipMemoryCard(${idx})" class="perspective h-24 sm:h-32 cursor-pointer group">
                                        <div class="relative w-full h-full duration-500 preserve-3d ${isFlipped ? 'rotate-y-180' : ''}" style="transform-style: preserve-3d; transition: transform 0.6s;">
                                            <!-- Back (Cover) -->
                                            <div class="absolute w-full h-full bg-purple-600 rounded-xl flex items-center justify-center text-white text-2xl shadow-md backface-hidden" style="backface-visibility: hidden;">
                                                ‚ùì
                                            </div>
                                            <!-- Front (Content) -->
                                            <div class="absolute w-full h-full ${isMatched ? 'bg-green-100 border-green-500' : 'bg-white'} border-2 rounded-xl flex flex-col items-center justify-center shadow-md backface-hidden" style="transform: rotateY(180deg); backface-visibility: hidden;">
                                                <span class="text-2xl">${card.icon}</span>
                                                <span class="font-bold text-center text-sm sm:text-base leading-tight p-1">${card.text}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            },

            // GAME 2: SCRAMBLE
            initScrambleGame: function() {
                const all = this.getAllVocab();
                this.state.scrambleWord = all[Math.floor(Math.random() * all.length)];
                this.state.scrambleInput = "";
                // Nur rendern, wenn wir im Tab sind
            },

            checkScramble: function(val) {
                this.state.scrambleInput = val;
                if (val.toLowerCase().trim() === this.state.scrambleWord.en.toLowerCase()) {
                    this.speak("Great job!");
                    setTimeout(() => {
                        this.initScrambleGame();
                        this.render();
                    }, 1500);
                } else {
                    // Re-render nur wenn n√∂tig vermeiden, hier simple DOM update w√§re besser, aber f√ºr Scramble ok
                    // Wir lassen es f√ºr jetzt re-rendern um Feedback zu zeigen
                    this.render(); 
                }
            },

            renderScramble: function(container) {
                if (!this.state.scrambleWord) this.initScrambleGame();
                const word = this.state.scrambleWord;
                // Buchstaben mischen
                const scrambled = word.en.split('').sort(() => 0.5 - Math.random()).join(' ');
                const isCorrect = this.state.scrambleInput.toLowerCase().trim() === word.en.toLowerCase();

                container.innerHTML = `
                    <div class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-xl text-center border-t-8 border-blue-500">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">üß© Word Scramble</h2>
                        <div class="text-6xl mb-4">${word.icon}</div>
                        
                        <div class="bg-blue-50 p-4 rounded-xl mb-6">
                            <p class="text-blue-800 font-mono text-2xl tracking-widest font-bold">${scrambled}</p>
                            <p class="text-xs text-blue-400 mt-2 uppercase">Bringe die Buchstaben in Ordnung</p>
                        </div>

                        <input type="text" 
                            oninput="app.checkScramble(this.value)"
                            value="${this.state.scrambleInput}"
                            class="w-full text-center text-2xl p-3 border-b-4 ${isCorrect ? 'border-green-500 bg-green-50' : 'border-gray-300 focus:border-blue-500'} outline-none transition-all placeholder-gray-300 mb-4"
                            placeholder="Type here..." autofocus>
                        
                        ${isCorrect ? `
                            <div class="animate-bounce text-green-600 font-bold text-xl">
                                ‚úÖ Correct! Next word coming...
                            </div>
                        ` : `
                            <div class="text-gray-400 text-sm flex justify-between px-4">
                                <span>üá©üá™ ${word.de}</span>
                                <span class="ar">üá∏üá¶ ${word.ar}</span>
                            </div>
                        `}
                        
                        <button onclick="app.initScrambleGame(); app.render()" class="mt-8 text-gray-400 text-sm underline hover:text-gray-600">Wort √ºberspringen</button>
                    </div>
                `;
                // Focus hack
                setTimeout(() => {
                    const inp = container.querySelector('input');
                    if(inp) {
                        inp.focus();
                        inp.setSelectionRange(inp.value.length, inp.value.length);
                    }
                }, 50);
            }
        };

        // Start the App
        app.init();

    </script>
</body>
</html>
